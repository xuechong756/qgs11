System.register([],(function(){"use strict";return{execute:function(){System.register("project:///assets/script/ani.ts",["cc"],(function(e,t){var i,o,s,a,r,n,l;return e({_dec:void 0,_class:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Vec3,a=e.tweenUtil}],execute:function(){cc._RF.push(window.module||{},"6ab90MLpmtFQLVLe/EeoXyK","ani"),l=i.ccclass,i.property,e("ani",(r=l("ani"),r(n=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)))).toVec=new s(0,0,0),i.toScale=new s(0,0,0),i.isMove=!1,i.isScale=!1,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){}},{key:"moveTo",value:function(e,t,i){if(cc.isValid(this.node)){this.isMove=!0,this.toVec=cc.v3(this.node.position);var o=this;a(this.toVec).to(e,t,{easing:"Cubic-Out"}).start().call((function(){o.isMove=!1,i&&i()}))}}},{key:"scaleTo",value:function(e,t,i){if(cc.isValid(this.node)){this.isScale=!0,this.toScale=this.node.getScale();var o=this;a(this.toScale).to(e,t,{easing:"Cubic-Out"}).start().call((function(){o.isScale=!1,i&&i()}))}}},{key:"update",value:function(e){cc.isValid(this.node)&&(this.isMove&&this.node.setPosition(this.toVec),this.isScale&&this.node.setScale(this.toScale))}}]),t}(o))||n)),cc._RF.pop()}}})),System.register("project:///assets/script/audio.ts",["cc"],(function(e,t){var i,o;return{setters:[function(e){i=e._decorator,o=e.AudioSourceComponent}],execute:function(){cc._RF.push(window.module||{},"44250gyQsZDv6rpC9bgA3Jh","audio"),i.ccclass,i.property,e("audio",{playSoundTime:0,audioMusic:null,audioSounds:[],playMusic:function(e,t){null==this.audioMusic&&(this.audioMusic=cc.find("Canvas").addComponent(o),this.audioMusic.loop=!0,this.audioMusic.playOnAwake=!0);var i=this;cc.loader.loadRes(e,(function(e,t){e?console.log(e):(i.audioMusic.clip=t,1==cc.storage.getStorage(cc.storage.music)&&i.audioMusic.play())}))},pauseMusic:function(){this.audioMusic.pause()},resumeMusic:function(){1==cc.storage.getStorage(cc.storage.music)&&this.audioMusic.play()},stopMusic:function(){this.audioMusic.stop()},getSoundAudio:function(){for(var e=null,t=0;t<this.audioSounds.length;t++)if(!this.audioSounds[t].playing){e=this.audioSounds[t];break}return null==e&&((e=cc.find("Canvas").addComponent(o)).loop=!1,this.audioSounds.push(e),cc.log("---s---",this.audioSounds.length)),e},playSound:function(e){if(1==cc.storage.getStorage(cc.storage.sound)){var t=(new Date).getTime();if(t-this.playSoundTime>200){this.playSoundTime=t;var i=this;cc.loader.loadRes(e,(function(e,t){if(!e){var o=i.getSoundAudio();o.playOneShot(t),cc.log(o.duration)}}))}}}}),cc._RF.pop()}}})),System.register("project:///assets/script/config.ts",["cc"],(function(e,t){var i;return{setters:[function(e){i=e._decorator}],execute:function(){cc._RF.push(window.module||{},"686dfzzBT9AsqhrIaiDBlzw","config"),i.ccclass,i.property,e("config",{nicks:["小猪佩奇","火车来了","李囧囧","陈诚","Koichi","思静","Roger","哭花了素颜、","Rajon","雁過藍天","Xa","昂贵的、背影","day","海藻","薇儿","可沁","泡泡龙","Tsukino","Th11111111","李勋蔚","迷路的男人","有你，很幸福","淡淡の、清香","怒放的可乐","小小","L","你这样没事","Kim","小棉","金色","Cook","L M Y","陈鱼","明牙","tina","叮当","kongbai","Ayden","keYkE","米兰","Rosanna","花樱","Nico","迷离世间","ZrhM","Alan","Golden","fy","秋叶","草莓","雪松","健平John","Аη","英英","米迦萊","别碰我","天涯海角","可儿","cxy","kitte","QQQ","ˋ.L.y.","mc","落叶知秋","哗啦啦","DIVA","虚伪了的真心","123","贝贝","晴天公仔","梦朦","夏三岁","King.","小猪宝宝","ruarua","SonGo松歌","非想","王司徒","Justice","冯新","贱狗","袭夜风","东东","谢震宇","为爱放弃","。。。","兲使愛檰糀","原来如此","大朋友","杰克","志平","Yin_pg","花菲","寻欢","Only","五毒少年","Sup`","悘","路西","阿欢","linda","藏乐大仙","Ada","Ally","Zero."],converToNodePos:function(e){return e.x=Math.floor(2*e.x+30.5+0),e.y=Math.floor(2*e.y+15.5+0),e.x<0&&(e.x=0),e.x>=61&&(e.x=60),e.y<0&&(e.y=0),e.y>=31&&(e.y=30),e},converToWorldPos:function(e){return e.x=(e.x-30.5)/2+0,e.y=(e.y-15.5)/2+0,e},judgeWall:function(e,t){for(var i=cc.v2(t).subtract(cc.v2(e)).normalize(),o=cc.v2(t).subtract(cc.v2(e)),s=0;s<=o;s+=.5){var a=cc.v2(e).add(i.multiplyScalar(s));if(a=this.converToNodePos(a),!this.astarmap[a.y][a.x])return!0}return!1},astarmap:[],astarmaps:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,1,1,1,1,1,0,1,0,0,0,0,1,1,1,0,0,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,1,0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,1,0,0,1,1,1,1,1,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,1,0,0,1,0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,1,1,0,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]}),cc._RF.pop()}}})),System.register("project:///assets/script/res.ts",["cc"],(function(e,t){var i,o,s,a;return{setters:[function(e){i=e._decorator,o=e.SpriteComponent,s=e.LabelComponent,a=e.Texture2D}],execute:function(){cc._RF.push(window.module||{},"2b168WuIhhDh4Agc2IrVXja","res"),i.ccclass,i.property,e("res",{loads:{},audio_music:"",nodePools:{},getObjByPool:function(e){this.nodePools[e]||(this.nodePools[e]=new cc.NodePool);return this.nodePools[e].size()>0?this.nodePools[e].get():cc.instantiate(this.loads[e])},putObjByPool:function(e,t){this.nodePools[t]||(this.nodePools[t]=new cc.NodePool),this.nodePools[t].put(e)},setSpriteFrame:function(e,t){cc.loader.loadRes(e,cc.SpriteFrame,(function(e,i){if(!e&&t&&cc.isValid(t)){var s=t.getComponent(o);s&&(s.spriteFrame=i)}}))},setSpriteFrameAtlas:function(e,t,i){cc.loader.loadRes(e,cc.SpriteAtlas,(function(e,s){!e&&i&&cc.isValid(i)&&(i.getComponent(o).spriteFrame=s.getSpriteFrame(t))}))},setTexture:function(e,t){cc.loader.loadRes(e,a,(function(e,i){!e&&t&&t.setProperty("albedoMap",i)}))},loadPic:function(e,t){cc.loader.load({url:e,type:"png"},(function(e,i){if(e)cc.log(e);else if(cc.isValid(t)){var s=new cc.SpriteFrame(i);t.getComponent(o).spriteFrame=s}}))},showToast:function(e){var t=cc.instantiate(this.loads.prefab_ui_toast);cc.find("label",t).getComponent(s).string=e,cc.find("Canvas").addChild(t,1e4),t.getComponent(o).scheduleOnce((function(){t.destroy()}),1.7)},openUI:function(e,t,i){if(t||(t=cc.find("Canvas/uiNode")),t){var o=t.getChildByName("ui_"+e);if(o)return void o.getChildByName("bg").getComponent(e).show(i);if(t["opening_"+e])return}t["opening_"+e]=!0,cc.loader.loadRes("prefab/ui/"+e,(function(o,s){if(t["opening_"+e]=!1,o)console.log("init error "+e,o);else{var a=cc.instantiate(s);a.name="ui_"+e,t.addChild(a),a.getChildByName("bg").getComponent(e).show(i)}}))},closeUI:function(e,t){if(t||(t=cc.find("Canvas/uiNode")),t){var i=t.getChildByName("ui_"+e);i&&i.destroy()}},getUI:function(e,t){if(t||(t=cc.find("Canvas/uiNode")),t){var i=t.getChildByName("ui_"+e);if(i)return i.getChildByName("bg").getComponent(e)}return null},openPrefab:function(e,t,i){t||(t=cc.find("Canvas/uiNode")),cc.loader.loadRes("prefab/"+e,(function(o,s){if(o)console.log("init error "+e,o);else{var a=cc.instantiate(s);t.addChild(a),i&&i(a)}}))}}),cc._RF.pop()}}})),System.register("project:///assets/script/loading.ts",["cc","./res.ts","./storage.ts","./sdk.ts","./qianqista.ts","./audio.ts"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b,m,g,v,y,C,x,S;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_dec4:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_descriptor3:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Node,a=e.ProgressBarComponent,r=e.LabelComponent},function(e){n=e.res},function(e){l=e.storage},function(e){c=e.sdk},function(e){d=e.qianqista},function(e){h=e.audio}],execute:function(){cc._RF.push(window.module||{},"ebfd3du0FFGdqzrhH0vnMwN","loading"),x=i.ccclass,S=i.property,cc.res=n,cc.storage=l,cc.sdk=c,cc.qianqista=d,cc.audio=h,cc.GAME={},cc.GAME.judgeLixian=!0,e("loading",(u=x("loading"),p=S(a),f=S(r),b=S(s),u((g=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"progressBar",v,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"progressTips",y,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"loadNode",C,babelHelpers.assertThisInitialized(i)),i.suburls=[],i.subCount=0,i.subTotalCount=0,i.purls=[],i.completedCount=0,i.totalCount=0,i.loadCount=0,i.nowtime=0,i.progress=0,i.resource=null,i.canLoadVideo=!0,i.isStart=!1,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"onLoad",value:function(){var e=this;d.init("wx83aa5365b3b6f2be","c2cbe456f71cb7e9826b2527284cf5a9","疯狂购物3D-微信",(function(){e.initNet()}),null),c.getUserInfo(),c.closeRank(),this.canLoadVideo=!0,0==l.getStorage(l.first)&&(l.setStorage(l.first,1),l.setStorage(l.music,1),l.setStorage(l.sound,1),l.setStorage(l.vibrate,1)),window.wx?this.loadSubpackage():this.loadAllRes()}},{key:"loadSubpackage",value:function(){this.suburls=["subpackages/mode/"],this.subTotalCount=this.suburls.length,this.loadSubpackageItem()}},{key:"loadSubpackageItem",value:function(){var e=this;cc.loader.downloader.loadSubpackage(this.suburls[this.subCount],(function(t){console.log("加载子包："+e.suburls[e.subCount],t),e.subCount++,e.subCount>=e.subTotalCount?e.loadAllRes():(e.progressBar.progress=e.progress,e.progressTips.string="加载中 "+Math.floor(e.subCount/e.subTotalCount*100)+"%",e.loadSubpackageItem())}))}},{key:"loadAllRes",value:function(){this.purls=["conf/game","conf/goods","conf/player","conf/map","conf/maptitle","conf/robotpath","conf/robotid","conf/robotlv","conf/playerlv","conf/starlv","conf/starrank","prefab/game/player","prefab/game/Res1","prefab/game/Res2","prefab/game/Res3","prefab/game/Res4","prefab/game/Res5","prefab/game/Res6","prefab/game/Res7","prefab/game/Res8","prefab/game/Res9","prefab/game/cube","prefab/skin/skin1","prefab/skin/skin2","prefab/skin/skin3","prefab/skin/skin4","prefab/skin/skin5","prefab/skin/skin6","prefab/skin/skin7","prefab/skin/skin8","prefab/skin/skin9","prefab/skin/skin10","prefab/anim/ParLvUp","prefab/ui/toast","prefab/ui/nick","prefab/ui/score","prefab/ui/countdown","prefab/ui/jiesuan","prefab/ui/jiesuan2","prefab/ui/skin","prefab/ui/lixian","prefab/ui/starup","prefab/ui/test"],this.totalCount=this.purls.length;for(var e=0;e<2;e++)this.loadres();this.loadCount=0,this.nowtime=(new Date).getTime()}},{key:"start",value:function(){}},{key:"loadres",value:function(){var e=this;if(this.loadCount<this.totalCount){var t=this.loadCount,i=this.purls[t];-1!=i.indexOf("images/sheep/")||-1!=i.indexOf("anims/")?cc.loader.loadRes(this.purls[t],cc.SpriteAtlas,(function(i,o){e.progressCallback(e.completedCount,e.totalCount,o,t)})):cc.loader.loadRes(this.purls[t],(function(i,o){e.progressCallback(e.completedCount,e.totalCount,o,t)})),this.loadCount++}}},{key:"progressCallback",value:function(e,t,i,o){this.progress=e/t,this.resource=i,this.completedCount++,this.progressBar.progress=this.progress,this.progressTips.string="加载中 "+Math.floor(this.completedCount/this.totalCount*100)+"%",this.setRes(i,o),this.completedCount>=this.totalCount?this.completeCallback():this.loadres(),this.canLoadVideo&&this.progress>.6&&(this.canLoadVideo=!1)}},{key:"completeCallback",value:function(){console.log("-----completeCallback---time:",(new Date).getTime()-this.nowtime),this.progressTips.string="加载完成",this.progressBar.progress=1,this.loadNode.active=!1,this.startGame()}},{key:"setRes",value:function(e,t){var i=this.purls[t],o="";-1!=i.indexOf("audio/")?o="audio_":-1!=i.indexOf("prefab/ui/")?o="prefab_ui_":-1!=i.indexOf("prefab/anim/")?o="prefab_anim_":-1!=i.indexOf("prefab/game/")?o="prefab_game_":-1!=i.indexOf("prefab/skin/")?o="prefab_skin_":-1!=i.indexOf("prefab/")?o="prefab_":-1!=i.indexOf("conf/")&&(o="conf_"+e.name,e=e.json),-1!=i.indexOf("conf/")?n.loads[o]=e:n.loads[o+e.data.name]=e}},{key:"startGame",value:function(){!this.loadNode.active&&this.progressBar.progress>=1&&!this.isStart&&(this.isStart=!0,this.progressBar.node.active=!1,cc.director.loadScene("main"))}},{key:"initNet",value:function(){var e=this,t=!1,i=!1;d.datas((function(o){console.log("my datas:",o),200==o.state&&e.updateLocalData(o.data),(t=!0)&&i&&(e.loadNode.active=!1,e.startGame())})),d.control((function(o){console.log("my control:",o),200==o.state&&(cc.GAME.control=o.data,e.updateUIControl()),i=!0,t&&i&&(e.loadNode.active=!1,e.startGame())}))}},{key:"updateUIControl",value:function(){if(cc.GAME.skipgame=null,cc.GAME.share=!1,cc.GAME.lixianswitch=!1,cc.GAME.adCheck=!0,cc.GAME.shares=[],cc.GAME.control.length>0)for(var e=0;e<cc.GAME.control.length;e++){var t=cc.GAME.control[e];if("skipgame"==t.id){if(t.value){var i=t.value.replace(/\'/g,'"');cc.GAME.skipgame=JSON.parse(i)}}else if(-1!=t.id.indexOf("share")){if("share"==t.id)cc.GAME.share=1==t.value;else if(t.value&&t.value.length>0){i=t.value.replace(/\'/g,'"');cc.GAME.shares.push(JSON.parse(i))}}else"lixian"==t.id?cc.GAME.lixianswitch=1==t.value:"adCheck"==t.id?cc.GAME.adCheck=1==t.value:cc.GAME[t.id]=t.value}}},{key:"updateLocalData",value:function(e){if(e){var t=JSON.parse(e);if(t.hasOwnProperty("coin")){var i=Number(t.coin),o=l.getStorage(l.coin);o>i&&(i=o),l.setStorage(l.coin,i)}t.hasOwnProperty("starlv")&&l.setStorage(l.starlv,Number(t.starlv)),t.hasOwnProperty("starexp")&&l.setStorage(l.starexp,Number(t.starexp)),t.hasOwnProperty("maxscore")&&l.setStorage(l.maxscore,Number(t.maxscore)),t.hasOwnProperty("maxscore2")&&l.setStorage(l.maxscore2,Number(t.maxscore2)),t.hasOwnProperty("speedlv")&&l.setStorage(l.speedlv,Number(t.speedlv)),t.hasOwnProperty("capacitylv")&&l.setStorage(l.capacitylv,Number(t.capacitylv)),t.hasOwnProperty("lixianlv")&&l.setStorage(l.lixianlv,Number(t.lixianlv)),t.hasOwnProperty("hasskin")&&l.setStorage(l.hasskin,t.hasskin),t.hasOwnProperty("skinid")&&l.setStorage(l.skinid,Number(t.skinid)),t.hasOwnProperty("loginday")&&l.setStorage(l.loginday,Number(t.loginday)),t.hasOwnProperty("logintime")&&l.setStorage(l.logintime,Number(t.logintime)),t.hasOwnProperty("modewinnum")&&l.setStorage(l.modewinnum,Number(t.modewinnum));var s=(new Date).getTime(),a=l.getStorage(l.logintime);if(l.isResetDay(s,a)){var r=l.getStorage(l.loginday);l.setStorage(l.loginday,r+1)}console.log("datas:",t)}}}]),t}(o),v=babelHelpers.applyDecoratedDescriptor(g.prototype,"progressBar",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=babelHelpers.applyDecoratedDescriptor(g.prototype,"progressTips",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=babelHelpers.applyDecoratedDescriptor(g.prototype,"loadNode",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=g))||m)),cc._RF.pop()}}})),System.register("project:///assets/script/sdk.ts",["cc","./storage.ts"],(function(e,t){var i,o;return{setters:[function(e){i=e._decorator},function(e){o=e.storage}],execute:function(){cc._RF.push(window.module||{},"ff6411dO6hLHIQF82itR53I","sdk"),i.ccclass,i.property,e("sdk",{bannerNum:0,is_iphonex:function(){if(!this._initiphonex){this._initiphonex=!0;var e=cc.view.getFrameSize().width/cc.view.getFrameSize().height,t=cc.view.getFrameSize().height/cc.view.getFrameSize().width;this.isIphoneX=e==1125/2436||e==1080/2280||e==720/1520||e==1080/2340||t>2}return this.isIphoneX},vibrate:function(e){1==o.getStorage(o.vibrate)&&window.wx&&(e?wx.vibrateLong({}):wx.vibrateShort({}))},keepScreenOn:function(){window.wx&&wx.setKeepScreenOn({keepScreenOn:!0})},uploadScore:function(e,t){window.wx?(wx.postMessage({message:"updateScore",score:Math.floor(e)}),t&&t()):t&&t()},openRank:function(e){window.wx&&wx.postMessage({message:"friendRank",worldrank:e})},closeRank:function(){window.wx&&wx.postMessage({message:"closeRank"})},openFuhuoRank:function(e){},closeFuhuoRank:function(){},getRankList:function(e){window.wx,e&&e(null)},getChaoyueRank:function(e,t){window.wx,e&&e(null)},videoLoad:function(){var e=this;window.wx&&(this.rewardedVideoAd=wx.createRewardedVideoAd({adUnitId:"adunit-f82cfca77c68b3d0"}),this.rewardedVideoAd.onLoad((function(){cc.GAME.hasVideo=!0,console.log("激励视频 广告加载成功")})),this.rewardedVideoAd.onClose((function(t){t&&t.isEnded||void 0===t?e.videocallback&&e.videocallback(!0):(e.videocallback&&e.videocallback(!1),cc.res.showToast("视频未看完！")),"main"==cc.myscene&&cc.storage.playMusic(cc.res.audio_music)})),this.rewardedVideoAd.onError((function(t){cc.GAME.hasVideo=!1,e.videocallback&&(e.videocallback(!1),cc.res.showToast("视频正在准备中...")),console.error(t)})),this.interstitialAd=null,wx.createInterstitialAd&&(this.interstitialAd=wx.createInterstitialAd({adUnitId:"adunit-208a14c8625961a8"}))),this.bannerTime=0},showVedio:function(e){var t=this;this.videocallback=e,window.wx?(cc.GAME.hasVideo=!1,this.rewardedVideoAd.show().catch((function(e){t.rewardedVideoAd.load().then((function(){t.rewardedVideoAd.show()}))})),cc.GAME.share&&this.share(e,"prop")):e&&e(!0)},showBanner:function(e,t,i){if(window.wx){if(this.bannerAd&&this.bannerNum<5)return this.bannerNum++,void this.bannerAd.show();var o=cc.view.getFrameSize(),s=cc.winSize.width/o.width,a=o.width,r=!0;cc.GAME.adCheck&&!this.is_iphonex()&&(r=!1,e&&t&&e.runAction(cc.sequence(cc.delayTime(.01),cc.callFunc((function(){t(-30*s)}))))),this.bannerAd=wx.createBannerAd({adUnitId:"adunit-948f2698c0f7e103",style:{left:0,top:o.height/s-300/3.5,width:a,height:100}});var n=this.bannerAd;this.bannerAd.onResize((function(a){n.style.left=o.width/2-a.width/2,n.style.top=o.height-a.height-1,n.res=a,r&&e&&t&&e.runAction(cc.sequence(cc.delayTime(.4),cc.callFunc((function(){var i=e.parent.convertToWorldSpaceAR(e.position).y-e.height*e.anchorY-a.height*s;t(i)})))),i&&(n.style.top=o.height+20)})),this.bannerAd.onError((function(e){console.error(e)})),this.bannerAd.show(),this.bannerTime=(new Date).getTime()}},hideBanner:function(){window.wx&&this.bannerAd&&this.bannerAd.hide()},getBannerDis:function(e){if(window.wx&&this.bannerAd&&e&&this.bannerAd.res){var t=cc.view.getFrameSize(),i=cc.winSize.width/t.width;return e.parent.convertToWorldSpaceAR(e.position).y-e.height*e.anchorY-this.bannerAd.res.height*i}return 0},moveBanner:function(){if(window.wx&&this.bannerAd&&this.bannerAd.res){var e=cc.view.getFrameSize();this.bannerAd.style.top=e.height-this.bannerAd.res.height-1}},showSpot:function(){window.wx&&this.interstitialAd&&this.interstitialAd.show().catch((function(e){console.error(e)}))},share:function(e,t){if(window.wx){var i="fromid="+cc.qianqista.openid+"&channel="+t,o="不一样的3D套圈游戏，童年的回忆。这次能否弥补当初百套不中的遗憾？",s="https://www.7q7q.top/share/2048_1.jpg";if(cc.GAME.shares.length>0){var a=Math.floor(Math.random()*cc.GAME.shares.length),r=cc.GAME.shares[a];r&&r.title&&r.imageUrl&&(o=r.title,s=r.imageUrl)}wx.shareAppMessage({query:i,title:o,imageUrl:s}),this.shareJudge(e)}else e&&e(!0)},shareJudge:function(e){cc.qianqista.sharetime=(new Date).getTime(),cc.qianqista.sharecallback=e},skipGame:function(e,t){if(window.wx&&e){wx.navigateToMiniProgram({appId:e,path:"pages/main/main?channel=sheep",extraData:{foo:"bar"},success:function(e){}})}},shortcut:function(){},getUserInfo:function(){window.wx?(wx.getSetting({success:function(e){console.log(e.authSetting),e.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(e){cc.sdk.userInfo=e.userInfo,cc.qianqista.login(!0,e.userInfo),wx.postMessage({message:"loginSuccess",userInfo:e.userInfo})}}):cc.qianqista.login(!1)}}),wx.showShareMenu({withShareTicket:!0,success:function(e){},fail:function(e){}}),wx.onShareAppMessage((function(e){return{query:"channel=sharemenu",withShareTicket:!0,title:"不一样的3D套圈游戏，童年的回忆。这次能否弥补当初百套不中的遗憾？",imageUrl:"https://www.7q7q.top/share/2048_1.jpg"}})),wx.updateShareMenu({withShareTicket:!0,success:function(e){},fail:function(e){}})):cc.qianqista.login(!1)},judgePower:function(){return!window.wx||1==cc.qianqista.power},openSetting:function(e){if(window.wx){var t=cc.view.getFrameSize(),i=cc.v2(t.width/2,.5*t.height),o=wx.createUserInfoButton({type:"text",text:"授权进入游戏",style:{left:i.x-60,top:i.y+20,width:120,height:40,backgroundColor:"#1779a6",borderColor:"#ffffff",borderRadius:4,textAlign:"center",fontSize:12,lineHeight:40}});o.onTap((function(t){console.log(t),t.errMsg.indexOf("auth deny")>-1||t.errMsg.indexOf("auth denied")>-1?e&&e(!1):(cc.sdk.userInfo=t.userInfo,cc.qianqista.login(!0,t.userInfo),wx.postMessage({message:"loginSuccess",userInfo:t.userInfo}),e&&e(!0)),o.destroy()}))}},showClub:function(){if(window.wx)if(this.clubBtn)this.clubBtn.show();else{var e=cc.view.getFrameSize();this.clubBtn=wx.createGameClubButton({icon:"green",style:{left:.03*e.width,top:.03*e.height,width:40,height:40}})}},hideClub:function(){this.clubBtn&&this.clubBtn.hide()},openKefu:function(){window.wx&&wx.openCustomerServiceConversation({})}}),cc._RF.pop()}}})),System.register("project:///assets/script/storage.ts",["cc"],(function(e,t){var i;return{setters:[function(e){i=e._decorator}],execute:function(){cc._RF.push(window.module||{},"22b1bwhS8lEYbALUmQ37Mcx","storage"),i.ccclass,i.property,e("storage",{pice:["k","m","b","t","a","aa","ab","ac","ad","ae","af","ag","ah","ai","aj","ak","al","am","an","ao","ap","aq","ar","as","at"],pfix:"shop_",music:"music",sound:"sound",vibrate:"vibrate",first:"first",coin:"coin",maxscore:"maxscore",maxscore2:"maxscore2",starlv:"starlv",starexp:"starexp",fuhuoNum:"fuhuoNum",mode:"mode",speedlv:"speedlv",capacitylv:"capacitylv",lixianlv:"lixianlv",skinid:"skinid",hasskin:"hasskin",loginday:"loginday",logintime:"logintime",modewinnum:"modewinnum",defaultVal:{music:1,sound:1,vibrate:1,first:0,coin:0,maxscore:0,maxscore2:0,starlv:1,starexp:0,fuhuoNum:0,mode:1,speedlv:0,capacitylv:0,lixianlv:0,skinid:0,hasskin:[],loginday:0,logintime:0,modewinnum:0},setStorage:function(e,t){"object"==babelHelpers.typeof(this.defaultVal[e])&&(t=JSON.stringify(t)),cc.sys.localStorage.setItem(this.pfix+e,t)},getStorage:function(e){var t=cc.sys.localStorage.getItem(this.pfix+e);return null===t||""===t||void 0===t?this.defaultVal[e]:"object"==babelHelpers.typeof(this.defaultVal[e])?JSON.parse(t):Number(t)},uploadStorage:function(e){var t={key:null};t[e]=this.getStorage(e);var i=JSON.stringify(t);cc.qianqista.uploaddatas(i)},scientificToNumber:function(e){var t=e.toString(),i=t.indexOf("e+");if(-1==i)return t;var o=t.substr(0,i),s="",a=parseInt(t.substr(i+2,t.length));if(o.indexOf(".")>=0){var r=o.split(".");o=r[0]+r[1],a-=r[1].length}for(var n=0;n<a;n++)s+="0";return o+s},castNum:function(e){e=Math.floor(e);var t=this.scientificToNumber(e),i="",o=0;t.length>3&&(o=Math.floor((t.length-1)/3)),o>0&&(e=(e/Math.pow(1e3,o)).toFixed(2));for(var s=(t=e+"").split(".")[0].split("").reverse(),a=0;a<s.length;a++)i+=s[a]+((a+1)%3==0&&a+1!=s.length?",":"");(i=i.split("").reverse().join(""),o>0)&&(i=i+"."+t.split(".")[1],i+=this.pice[o-1]);return i},getLabelStr:function(e,t){for(var i="",o=0,s=0;s<e.length;s++){var a=e.charCodeAt(s);if(a>=1&&a<=126||65376<=a&&a<=65439){if(++o>=t-2){s!=e.length-1&&(i+="...");break}i+=e.charAt(s)}else{if((o+=2)>=t-2){s!=e.length-1&&(i+="...");break}i+=e.charAt(s)}}return i},getCountDown:function(e,t,i){var o=t-e;return this.fomatTime(o,i)},fomatTime:function(e,t){var i="";if(t||(t=3),e<=0)return 1==t?i="00":2==t?i="00:00":3==t&&(i="00:00:00"),i;var o=Math.floor(e/864e5),s=Math.floor((e-24*o*60*60*1e3)/36e5),a=Math.floor((e-24*o*60*60*1e3-60*s*60*1e3)/6e4),r=Math.floor((e-24*o*60*60*1e3-60*s*60*1e3-60*a*1e3)/1e3),n=s<10?"0"+s:s,l=a<10?"0"+a:a,c=r<10?"0"+r:r;return i=1==t?c+"":2==t?l+":"+c:3==t?n+":"+l+":"+c:o>0?(o<10?"0"+o:o)+":"+n+":"+l+":"+c:n+":"+l+":"+c},isResetDay:function(e,t){var i=new Date(e),o=new Date(t);return o.getFullYear()!=i.getFullYear()||(o.getMonth()!=i.getMonth()||o.getDate()!=i.getDate())},indexOf:function(e,t){for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1}}),cc._RF.pop()}}})),System.register("project:///assets/script/qianqista.ts",["cc"],(function(e,t){var i;return{setters:[function(e){i=e._decorator}],execute:function(){cc._RF.push(window.module||{},"fd419QCSWlG1YyINkUUQqCz","qianqista"),i.ccclass,i.property,e("qianqista",{gameId:"",secret:"",gameName:"",channel:"",openid:"",userName:"",session_key:"",power:0,url:"https://game.7q7q.top/sta/",url2:"https://game.7q7q.top/sheep/",avatarUrl:"",state:0,updatePower:!1,initcallback:null,logincallback:null,showcallback:null,hidecallback:null,onshowmaincallback:null,fromid:"",pkfromid:"",sharetime:0,sharenum:0,init:function(e,t,i,o,s){this.gameId=e,this.secret=t,this.gameName=i,this.initcallback=o,this.showcallback=s;var a=this;if(cc.sys.os==cc.sys.OS_ANDROID||cc.sys.os==cc.sys.OS_IOS){var r=wx.getLaunchOptionsSync();if(r){var n=r.path,l=r.query,c=r.scene;n&&-1!=n.indexOf("channel=")&&(this.channel=n.substr(n.indexOf("channel=")+8),this.channel.length>16&&(this.channel=this.channel.substr(0,15))),""!=this.channel&&null!=this.channel||l&&l.channel&&l.channel.length>0&&(this.channel=l.channel),""!=this.channel&&null!=this.channel||(this.channel=c+""),l&&l.fromid&&l.fromid.length>0&&(this.fromid=l.fromid,console.log("fromid:",l.fromid)),cc.sys.localStorage.getItem("channel")||cc.sys.localStorage.setItem("channel",this.channel)}console.log("opts:",r),console.log("channel:",this.channel),wx.onShow((function(e){if(a.open(),a.sharecallback){var t=(new Date).getTime();a.sharetime&&t-a.sharetime>3e3?(a.sharecallback(!0),a.sharenum++):(a.sharenum++,a.sharecallback(!1),cc.res.showToast("请分享到不同的群！")),a.sharecallback=null}console.log("onShow:",e),console.log("power:",a.power);var i=e.query;i&&i.fromid&&i.fromid.length>0&&(a.pkfromid=i.fromid),1==a.power&&i&&i.channel&&"shareonline"==i.channel&&a.pkfromid&&a.showcallback&&a.showcallback(),a.isHide&&(a.isHide=!1),a.onshowmaincallback&&a.onshowmaincallback(e.scene)})),wx.onHide((function(){a.hidecallback&&a.hidecallback(),a.isHide=!0}))}else"chrome"==cc.sys.browserType?(this.openid="test001",this.userName="哈哈",this.avatarUrl="https://game.7q7q.top/img/wxgame/49234a872c294891aa98877d51679180.png",this.fromid="test002",this.pkfromid="test002"):(this.openid="test002",this.userName="嘿嘿",this.avatarUrl="https://game.7q7q.top/img/wxgame/1b6474f6563845c4a5afd5b9a797c017.png",this.fromid="test001")},setHideCallback:function(e){this.hidecallback=e},login:function(e,t,i){this.logincallback=i,e?(t||console.error("--------","userInfo is null"),this.userName=t.nickName,this.power=1,this.avatarUrl=t.avatarUrl,console.log("userInfo:",t)):this.updatePower=!0;var o=this;this.getOpenId((function(){o.state=1,o.initdata(),console.log("----init end ----")}))},initdata:function(){if(1==this.state){var e=this;this.sendRequest("init",{gameId:this.gameId,gameName:this.gameName,channel:this.channel,openid:this.openid,userName:this.userName,power:this.power},(function(t){console.log("init:",t),e.initcallback&&e.initcallback(),e.fromid&&e.fromid.length>1&&e.fromid!=e.openid&&e.sendRequest("datas",{gameId:e.gameId,openid:e.fromid},(function(t){if(200==t.state){for(var i=JSON.parse(t.data),o={ginvitelist:null},s=null==i.ginvitelist?[]:i.ginvitelist,a={openid:e.openid,name:e.userName,pic:e.avatarUrl},r=!1,n=0;n<s.length;n++)if(s[n].openid==a.openid){r=!0;break}if(!r){s.push(a),o.ginvitelist=s;var l=JSON.stringify(o);console.log("upload invitelist:",l),e.sendRequest("uploaddatas",{gameId:e.gameId,openid:e.fromid,datas:l},(function(e){console.log("upload invitelist:",e)}))}var c={gjiabeilist:null},d=null==i.gjiabeilist?[]:i.gjiabeilist;for(a={openid:e.openid,name:e.userName,pic:e.avatarUrl},r=!1,n=0;n<d.length;n++)if(d[n].openid==a.openid){r=!0;break}if(!r){d.push(a),c.gjiabeilist=d;l=JSON.stringify(c);console.log("upload jiabeilist:",l),e.sendRequest("uploaddatas",{gameId:e.gameId,openid:e.fromid,datas:l},(function(e){console.log("upload jiabeilist:",e)}))}}}))})),this.updatePower&&1==this.power&&(this.updatePower=!1,this.sendRequest("power",{gameId:this.gameId,channel:this.channel,openid:this.openid,power:this.power},(function(e){console.log("power:",e)}))),1==this.power&&"shareonline"==e.channel&&this.logincallback&&this.logincallback(),1==this.power&&this.pdatas((function(t){1==t.state&&e.paddUser((function(e){}),cc.storage.getToalCoin()/cc.config.totalCoinRate)}))}},open:function(){1==this.state&&this.sendRequest("open",{gameId:this.gameId,channel:this.channel},(function(e){console.log("open:",e)}))},pay:function(e){1==this.state&&this.sendRequest("pay",{gameId:this.gameId,channel:this.channel,openid:this.openid,money:e},(function(e){console.log("pay:",e)}))},share:function(e){if(1==this.state){var t=0;e&&(t=1),this.sendRequest("share",{gameId:this.gameId,channel:this.channel,openid:this.openid,share:t},(function(e){console.log("share:",e)}))}},event:function(e){1==this.state&&this.sendRequest("event",{gameId:this.gameId,channel:this.channel,openid:this.openid,eventId:e},(function(e){console.log("event:",e)}))},control:function(e){this.sendRequest("control",{gameId:this.gameId},(function(t){console.log("control:",t),e&&e(t)}))},datas:function(e){1==this.state&&this.sendRequest("datas",{gameId:this.gameId,openid:this.openid},(function(t){console.log("datas:",t),e&&e(t)}))},uploaddatas:function(e,t){1==this.state&&this.httpPost("uploaddatas",{gameId:this.gameId,openid:this.openid,datas:e},(function(e){console.log("uploaddatas:",e),t&&t(e)}))},getOpenId:function(e){var t=this;cc.sys.os==cc.sys.OS_ANDROID||cc.sys.os==cc.sys.OS_IOS?wx.login({success:function(i){console.log("login:",i),t.sendRequest("jscode2session",{gameId:t.gameId,gameSecret:t.secret,jsCode:i.code},(function(i){if(200==i.state){var o=JSON.parse(i.msg);t.session_key=o.session_key,t.openid=o.openid,console.error("openid:",t.openid)}e&&e(),console.log("jscode2session:",i)}))}}):e&&e()},getGrpupId:function(e,t,i){if(1==this.state){cc.sys.os!=cc.sys.OS_ANDROID&&cc.sys.os!=cc.sys.OS_IOS||this.httpPost("groupid",{encryptedData:e,sessionkey:this.session_key,iv:t},(function(e){if(200==e.state){var t=e.data,o=null!=t&&"null"!=t;console.log("groupid:",t.openGId),i&&(1==o?i(o,t.openGId,1e3*t.watermark.timestamp):i(o))}console.log("groupid:",e)}))}},sendRequest:function(e,t,i){var o=cc.loader.getXMLHttpRequest(),s="?";for(var a in t)"?"!=s&&(s+="&"),s+=a+"="+t[a];var r=this.url+e+encodeURI(s);return console.log("RequestURL:"+r),o.open("GET",r,!0),o.onreadystatechange=function(){if(4===o.readyState&&o.status>=200&&o.status<300)try{var e=JSON.parse(o.responseText);null!==i&&i(e)}catch(e){console.log("sendRequest Err:"+e)}},o.timeout=5e3,cc.sys.isNative&&o.setRequestHeader("Accept-Encoding","gzip,deflate","text/html;charset=UTF-8"),o.send(),o},httpPost:function(e,t,i){var o=cc.loader.getXMLHttpRequest(),s=this.url+e;console.log("RequestURL:"+s,t),o.onreadystatechange=function(){if(4===o.readyState&&o.status>=200&&o.status<300)try{var e=JSON.parse(o.responseText);null!==i&&i(e)}catch(e){console.log("sendRequest Err:"+e)}},o.open("POST",s,!0),cc.sys.isNative&&o.setRequestHeader("Accept-Encoding","gzip,deflate"),o.timeout=5e3,o.send(t)},pdatas:function(e){1==this.state&&this.sendRequest2("datas",{openid:this.openid},(function(t){console.log("pdatas:",t),e&&e(t)}))},paddUser:function(e,t){if(1==this.state){if(this.avatarUrl.length<5||0==this.power)return void(e&&e(null));var i=this.avatarUrl;i=i.replace(/&/g,"---"),this.httpPost2("addUser",{openid:this.openid,nick:this.userName,avatarUrl:i,score:t},(function(t){console.log("addUser:",t),e&&e(t)}))}},pupdateInfo:function(e){if(1==this.state){if(this.avatarUrl.length<5)return void(e&&e(null));var t=this.avatarUrl;t=t.replace(/&/g,"---"),this.httpPost2("updateInfo",{openid:this.openid,nick:this.userName,avatarUrl:t},(function(t){console.log("updateInfo:",t),e&&e(t)}))}},uploadScore:function(e){1==this.state&&(e=Math.floor(e),this.sendRequest2("uploadScore",{openid:this.openid,score:e},(function(e){console.log("uploadScore:",e)})))},rankScore:function(e){1==this.state&&this.sendRequest2("rankScore",{openid:this.openid,rows:50},(function(t){console.log("rankScore:",t),e&&e(t)}))},rankSelf:function(e){1==this.state&&this.sendRequest2("rankSelf",{openid:this.openid},(function(t){console.log("rankSelf:",t),e&&e(t)}))},subTime:function(e){1==this.state&&this.sendRequest2("subTime",{},(function(t){console.log("subTime:",t),e&&e(t)}))},updateUnionId:function(e){1==this.state&&this.sendRequest2("updateUnionId",{openid:this.openid,unionId:this.unionId},(function(t){console.log("updateUnionId:",t),e&&e(t)}))},randRobot:function(e){1==this.state&&this.sendRequest2("rankScore",{page:10+Math.floor(40*Math.random()),rows:4},(function(t){console.log("rankScore:",t),e&&e(t)}))},sendRequest2:function(e,t,i){var o=cc.loader.getXMLHttpRequest(),s="?";for(var a in t)"?"!=s&&(s+="&"),s+=a+"="+t[a];var r=this.url2+e+encodeURI(s);return console.log("RequestURL:"+r),o.open("GET",r,!0),o.onreadystatechange=function(){if(4===o.readyState&&o.status>=200&&o.status<300)try{var e=JSON.parse(o.responseText);null!==i&&i(e)}catch(e){console.log("sendRequest Err:"+e,r)}},o.timeout=5e3,cc.sys.isNative&&o.setRequestHeader("Accept-Encoding","gzip,deflate","text/html;charset=UTF-8"),o.send(),o},httpPost2:function(e,t,i){var o=cc.loader.getXMLHttpRequest(),s=this.url2+e;console.log("RequestURL:"+s),o.onreadystatechange=function(){if(4===o.readyState&&o.status>=200&&o.status<300)try{var e=JSON.parse(o.responseText);null!==i&&i(e)}catch(e){console.log("sendRequest Err:"+e)}},o.open("POST",s,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),cc.sys.isNative&&o.setRequestHeader("Accept-Encoding","gzip,deflate"),o.timeout=5e3;var a="",r=0;for(var n in t)0!=r&&(a+="&"),a+=n+"="+t[n],r++;o.send(a)}}),cc._RF.pop()}}})),System.register("project:///assets/script/game/CameraFollow.ts",["cc"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_descriptor3:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Node,a=e.Vec3}],execute:function(){cc._RF.push(window.module||{},"ea954wqAS5G9LYbu/Zs6chE","CameraFollow"),f=i.ccclass,b=i.property,new a,new a,new a,e("CameraFollow",(r=f("CameraFollow"),n=b({type:s}),l=b({type:a}),r((d=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"lookTarget",h,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"offset",u,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"epsilon",p,babelHelpers.assertThisInitialized(i)),i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){}},{key:"update",value:function(e){var t=cc.v3(this.lookTarget.worldPosition);t.x+=this.offset.x,t.y=this.offset.y,t.z+=this.offset.z,this.node.worldPosition=t}}]),t}(o),h=babelHelpers.applyDecoratedDescriptor(d.prototype,"lookTarget",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=babelHelpers.applyDecoratedDescriptor(d.prototype,"offset",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new a}}),p=babelHelpers.applyDecoratedDescriptor(d.prototype,"epsilon",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.001}}),c=d))||c)),cc._RF.pop()}}})),System.register("project:///assets/script/game/Goods.ts",["cc","../GColl/GBoxColl.ts","../ani.ts","../config.ts"],(function(e,t){var i,o,s,a,r,n,l,c;return e({_dec:void 0,_class:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component},function(e){s=e.GBoxColl},function(e){a=e.ani},function(e){r=e.config}],execute:function(){cc._RF.push(window.module||{},"e4747A7yIlNkrNhxmnI6GIm","Goods"),c=i.ccclass,i.property,e("Goods",(n=c("Goods"),n(l=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)))).state="idle",i.goodsId=0,i.moveDir=cc.v2(0,0),i.gBoxColl=null,i.conf={Require:"1",Score:"1",Capacity:"1",CapacityAdd:"0"},i.collPos=null,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.gBoxColl=this.node.getComponent(s)}},{key:"initConf",value:function(e,t){this.goodsId=e,this.collPos=t;var i=cc.res.loads.conf_goods[e-1];this.conf=JSON.parse(JSON.stringify(i))}},{key:"drop",value:function(){this.state="idle",this.gBoxColl.enable(!0)}},{key:"hold",value:function(e){if(this.state="hold",this.gBoxColl.enable(!1),e&&cc.sdk.vibrate(),this.collPos)for(var t=0;t<this.collPos.length;t++){var i=r.converToNodePos(cc.v2(this.collPos[t].x,this.collPos[t].z));r.astarmap[i.y][i.x]=1}}},{key:"die",value:function(e,t,i){this.state="die";var o=this,s=this.node.addComponent(a),r=this.node.getPosition(),n=cc.v2(e.x,e.z).subtract(cc.v2(r.x,r.z)).normalize(),l=.6*cc.Vec2.distance(cc.v2(e.x,e.z),cc.v2(r.x,r.z)),c=cc.v3(r.x+n.x*l,e.y+5,r.z+n.y*l);this.scheduleOnce((function(){s.moveTo(.3,c,(function(){s.moveTo(.2,e,(function(){cc.isValid(o.node)&&o.node.destroy(),i&&cc.sdk.vibrate()}))}))}),t)}},{key:"canHold",value:function(e){return e>=Number(this.conf.Require)}}]),t}(o))||l)),cc._RF.pop()}}})),System.register("project:///assets/script/game/PlayerSelf.ts",["cc","./Player.ts"],(function(e,t){var i,o,s,a,r,n;return e({_dec:void 0,_class:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.SystemEvent},function(e){s=e.Player}],execute:function(){cc._RF.push(window.module||{},"fe9a3U+RuhOZoNMG3VXE2b8","PlayerSelf"),n=i.ccclass,i.property,e("PlayerSelf",(a=n("PlayerSelf"),a(r=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)))).startTouchPos=null,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"onLoad",value:function(){this.initEvent()}},{key:"start",value:function(){var e=cc.storage.getStorage(cc.storage.skinid);this.initNick("留个名吧",e),babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"start",this).call(this),this.isPlayerSelf=!0,this.initConf(1)}},{key:"initEvent",value:function(){cc.systemEvent.on(o.EventType.TOUCH_START,this.onTouchStart,this),cc.systemEvent.on(o.EventType.TOUCH_MOVE,this.onTouchMove,this),cc.systemEvent.on(o.EventType.TOUCH_END,this.onTouchEnd,this)}},{key:"onTouchStart",value:function(e){this.startTouchPos=e.getLocation()}},{key:"onTouchMove",value:function(e){var t=e.getLocation();this.moveDir=t.subtract(this.startTouchPos).normalize(),this.moveDir=cc.v2(-this.moveDir.x,this.moveDir.y).rotate(Math.PI),this.isMove=!0}},{key:"onTouchEnd",value:function(e){this.isMove=!1}},{key:"update",value:function(e){this.updateStep(e)}}]),t}(s))||r)),cc._RF.pop()}}})),System.register("project:///assets/script/game/PlayerFollow.ts",["cc","./Player.ts"],(function(e,t){var i,o,s,a,r;return e({_dec:void 0,_class:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator},function(e){o=e.Player}],execute:function(){cc._RF.push(window.module||{},"2ffe95CENJKuL2PBTU/yDP0","PlayerFollow"),r=i.ccclass,i.property,e("PlayerFollow",(s=r("PlayerFollow"),s(a=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)))).upDirDt=10,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"start",this).call(this),this.isFollowPlayer=!0}},{key:"updateMoveDir",value:function(){if(null!=this.followTarget&&!this.isColl){var e=this.node.getPosition(),t=this.followTarget.node.getPosition();this.moveDir=cc.v2(t.x,t.z).subtract(cc.v2(e.x,e.z)).normalize(),Math.random()<.2&&(this.moveDir=cc.v2(Math.random()-.5,Math.random()-.5).normalize()),this.isMove=!0}}},{key:"update",value:function(e){this.gameControl.isStart?(this.upDirDt+=e,this.upDirDt>=1&&(this.upDirDt=0,this.updateMoveDir()),this.updateStep(e)):(this.isMove=!1,this.idle())}}]),t}(o))||a)),cc._RF.pop()}}})),System.register("project:///assets/script/game/Player.ts",["cc","../ani.ts","../GColl/GBoxColl.ts","../GColl/GCollControl.ts","./Goods.ts","../config.ts"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b;return e({_dec:void 0,_class:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.SkeletalAnimationComponent,a=e.ModelComponent,r=e.Color,n=e.LabelComponent},function(e){l=e.ani},function(e){c=e.GBoxColl},function(e){d=e.GCollControl},function(e){h=e.Goods},function(e){u=e.config}],execute:function(){cc._RF.push(window.module||{},"3cb11eitGBG16CGOPpxSoA1","Player"),b=i.ccclass,i.property,e("Player",(p=b("Player"),p(f=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)))).moveDir=cc.v2(0,0),i.isMove=!1,i.isColl=!1,i.moveSpeed=4,i.isCanColl=!0,i.lv=1,i.gameControl=null,i.state="idle",i.gcoll=null,i.goods=[],i.hands=[],i.skinNodes=[],i.follow=[],i.followTarget=null,i.conf={Score:"10",Capacity:"8",Speed:"1",PlayerNum:"1"},i.currCapacity=0,i.currScore=0,i.isPlayerSelf=!1,i.isFollowPlayer=!1,i.isRobot=!1,i.robotId=0,i.robotConfId={ID:1,range:1,collect:0,wander:0,rob:0,avoid:0,capacitylimit:60,wandertime:10},i.robotConflv={lv:1,pay:90,collect:80,wander:80,rob:0,avoid:0},i.robotConfPath=[],i.toHoldGoodsTime=0,i.tarGoods=null,i.tarPlayer=null,i.bodyColor=r.WHITE.clone(),i.uiNick=null,i.nickNode=null,i.kingNode=null,i.nick="",i.skinId=0,i.currCollNode=null,i.currEmojiType="",i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.gameControl=cc.find("gameNode").getComponent("gameControl"),this.node.addComponent(l),this.gcoll=this.node.getComponent(c),this.gcoll&&this.gcoll.setCollcallback(this.collEnter.bind(this));var e=this.node.getComponent(s).sockets;if(e.length>=2)for(var t=0;t<2;t++)this.hands.push(cc.find("node",e[t].target));for(t=2;t<e.length;t++)this.skinNodes.push(cc.find("node",e[t].target));cc.find("RootNode/player_01",this.node).getComponent(a).material.setProperty("albedo",this.bodyColor),this.nickNode=cc.find("head",this.node),this.gameControl&&(this.uiNick=cc.instantiate(cc.res.loads.prefab_ui_nick),this.uiNick.parent=this.gameControl.gameUI,this.uiNick.getComponent(n).string="Lv.1 "+this.nick),this.kingNode=cc.find("king",this.nickNode),this.initSkin()}},{key:"initNick",value:function(e,t){this.nick=e,this.skinId=t}},{key:"initConf",value:function(e){this.lv=e;var t=cc.res.loads.conf_player[e-1];if(this.conf=JSON.parse(JSON.stringify(t)),this.isRobot){t=cc.res.loads.conf_robotlv[this.lv-1];this.robotConflv=JSON.parse(JSON.stringify(t)),this.robotConfPath=JSON.parse(JSON.stringify(cc.res.loads.conf_robotpath[this.lv-1]))}if(this.isPlayerSelf){e=cc.storage.getStorage(cc.storage.speedlv);var i=cc.res.loads.conf_playerlv[e];this.moveSpeed=this.moveSpeed*(1+Number(i.speed)/100);e=cc.storage.getStorage(cc.storage.capacitylv),i=cc.res.loads.conf_playerlv[e];this.conf.Capacity=Number(this.conf.Capacity)*(1+Number(i.capacity)/100)+""}this.uiNick&&(this.uiNick.getComponent(n).string="Lv."+this.lv+" "+this.nick)}},{key:"initRobotConf",value:function(e){if(e&&e<cc.res.loads.conf_robotid.length){var t=cc.res.loads.conf_robotid[e-1];this.robotConfId=JSON.parse(JSON.stringify(t))}t=cc.res.loads.conf_robotlv[this.lv-1];this.robotConflv=JSON.parse(JSON.stringify(t)),this.robotConfPath=JSON.parse(JSON.stringify(cc.res.loads.conf_robotpath[this.lv-1]))}},{key:"initSkin",value:function(){if(this.skinId){for(var e=cc.instantiate(cc.res.loads["prefab_skin_skin"+this.skinId]),t=[],i=0;i<e.children.length;i++)t.push(e.children[i]);this.skinNodes[0].destroyAllChildren(),this.skinNodes[1].destroyAllChildren(),this.skinNodes[2].destroyAllChildren(),this.skinNodes[3].destroyAllChildren(),this.skinNodes[4].destroyAllChildren();for(i=0;i<t.length;i++){var o=t[i];o.setPosition(cc.v3(0,0,0)),o.setRotation(0,0,0,0),"Bip001 Head Socket"==o.name?o.parent=this.skinNodes[0]:"Bip001 Neck Socket"==o.name?o.parent=this.skinNodes[1]:"Bip001 Spine Socket"==o.name?o.parent=this.skinNodes[2]:"Bip001 L Foot Socket"==o.name?o.parent=this.skinNodes[3]:"Bip001 R Foot Socket"==o.name&&(o.parent=this.skinNodes[4])}}}},{key:"run",value:function(){"run"!=this.state&&"post"!=this.state&&(this.node.getComponent(s).play("run"),this.state="run")}},{key:"idle",value:function(){if("idle"!=this.state){var e=Math.floor(2*Math.random()+1);this.node.getComponent(s).play("idle"+e),this.state="idle",this.showEmoji("idle")}}},{key:"hurt",value:function(){if("hurt"!=this.state){this.node.getComponent(s).play("hurt"),this.state="hurt";var e=this;this.scheduleOnce((function(){e.idle()}),1.1),this.dropGoods(),this.showEmoji("hurt")}}},{key:"updateDir",value:function(e){if(0!=e.x||0!=e.y){var t=cc.v2(e).signAngle(cc.v2(0,1)),i=180/Math.PI*t;this.node.setRotationFromEuler(0,i,0)}}},{key:"holdGoods",value:function(e){if("idle"==e.state&&e.canHold(this.lv)&&this.currCapacity+Number(e.conf.Capacity)<=Number(this.conf.Capacity)&&this.hands.length>0){e.hold(this.isPlayerSelf),this.goods.push(e),this.currCapacity+=Number(e.conf.Capacity);var t=this.goods.length%this.hands.length,i=1;if(1==t&&(i=-1),e.node.setPosition(cc.v3(.2*Math.random()*i,.2*Math.random()*i,.2*Math.random()*i)),e.node.parent=this.hands[t],this.isRobot)this.toHoldGoodsTime=0,this.findCanHoldGoods(0)||this.node.emit("excAi");else this.isPlayerSelf&&this.gameControl.updateSelfCapacity(this.currCapacity/Number(this.conf.Capacity));this.showEmoji("get")}}},{key:"dropGoods",value:function(){for(var e=Math.floor(this.goods.length/2),t=0;t<e;t++){var i=this.goods[t];i.drop(),this.currCapacity-=Number(i.conf.Capacity);var o=cc.v3(i.node.getWorldPosition());o.y=0,i.node.setPosition(o),i.node.parent=this.gameControl.goodsNode}this.isPlayerSelf&&this.gameControl.updateSelfCapacity(this.currCapacity/Number(this.conf.Capacity)),this.goods.splice(0,e)}},{key:"postGoods",value:function(){if(this.goods.length>0&&"post"!=this.state){this.node.getComponent(s).play("post"),this.state="post";for(var e=this.goods.length,t=0;t<e;t++){var i=this.goods.pop();this.currCapacity-=Number(i.conf.Capacity),this.addScore(Number(i.conf.Score)),this.isPlayerSelf||this.isRobot||this.followTarget.addScore(Number(i.conf.Score));var o=cc.v3(i.node.getWorldPosition());i.node.setPosition(o),i.node.parent=this.gameControl.goodsNode,i.die(this.gameControl.cashier.getPosition(),.05*t,this.isPlayerSelf),this.addScoreAni(.05*t,Number(i.conf.Score))}this.isPlayerSelf&&(this.gameControl.updateSelfCapacity(this.currCapacity/Number(this.conf.Capacity)),this.gameControl.updateHold(e));var a=this;this.scheduleOnce((function(){a.idle(),0==a.goods.length&&a.node.emit("excAi")}),.5),e>0&&this.showEmoji("post")}}},{key:"addScoreAni",value:function(e,t){var i=this;this.scheduleOnce((function(){var e=cc.res.getObjByPool("prefab_ui_score");e.parent=i.uiNick,e.setPosition(cc.v3(0,40,0)),e.setScale(2,2,2),e.getComponent(n).string="+"+t;var o=e.getComponent(l);o.moveTo(1,cc.v3(0,200,0)),o.scaleTo(1,cc.v3(.5,.5,.5),(function(){cc.res.putObjByPool(e,"prefab_ui_score")})),i.gameControl.playPostAni(),i.isPlayerSelf&&cc.audio.playSound("audio/coin")}),e)}},{key:"showEmoji",value:function(e){if(!(Math.random()<.3)){var t=cc.find("emojibg",this.uiNick);if(!t.active||this.currEmojiType!=e){var i=cc.find("emojibg/emoji",this.uiNick);"idle"==e?cc.res.setSpriteFrame("images/emoji/idle/"+Math.floor(7*Math.random()+1)+"/spriteFrame",i):"attack"==e?cc.res.setSpriteFrame("images/emoji/attack/"+Math.floor(7*Math.random()+1)+"/spriteFrame",i):"get"==e?cc.res.setSpriteFrame("images/emoji/get/"+Math.floor(6*Math.random()+1)+"/spriteFrame",i):"hurt"==e?cc.res.setSpriteFrame("images/emoji/hurt/"+Math.floor(8*Math.random()+1)+"/spriteFrame",i):"lvup"==e?cc.res.setSpriteFrame("images/emoji/lvup/"+Math.floor(4*Math.random()+1)+"/spriteFrame",i):"post"==e&&cc.res.setSpriteFrame("images/emoji/post/"+Math.floor(6*Math.random()+1)+"/spriteFrame",i),t.active=!0,this.currEmojiType=e,this.unschedule(this.hideEmoji.bind(this)),this.scheduleOnce(this.hideEmoji.bind(this),2)}}}},{key:"hideEmoji",value:function(){cc.find("emojibg",this.uiNick).active=!1}},{key:"showKing",value:function(e){this.kingNode.active=e}},{key:"findCanHoldGoods",value:function(e){var t=this.node.getPosition(),i={x:t.x,y:t.z};1==e?i.y+=1:2==e?i.y-=1:3==e?i.x-=1:4==e&&(i.x+=1);var o=d.ins.maps[Math.round(i.x)+"_"+Math.round(i.y)];if(this.tarGoods=null,o&&o.length>0)for(var s=0;s<o.length;s++)if(-1!=this.gameControl.goodsNames.indexOf(o[s].node.name)){var a=o[s].node.getComponent(h);if("idle"==a.state&&a.canHold(this.lv)&&this.currCapacity+Number(a.conf.Capacity)<=Number(this.conf.Capacity)&&u.judgeWall(cc.v2(t.x,t.z),cc.v2(i.x,i.y))){this.tarGoods=a.node;break}}return e++,!this.tarGoods&&e<4?this.findCanHoldGoods(e):this.tarGoods}},{key:"findOtherPlayer",value:function(e){var i=this.node.getPosition(),o={x:i.x,y:i.z};1==e?o.y+=1:2==e?o.y-=1:3==e?o.x-=1:4==e?o.x+=1:5==e?o.y+=2:6==e?o.y-=2:7==e?o.x-=2:8==e&&(o.x+=2);var s=d.ins.maps[Math.round(o.x)+"_"+Math.round(o.y)];if(this.tarPlayer=null,s&&s.length>0)for(var a=0;a<s.length;a++)if(-1!="player".indexOf(s[a].node.name)){var r=s[a].node.getComponent(t);if(r!=this&&(r.isPlayerSelf||r.isRobot||r.isFollowPlayer&&r.followTarget!=this)){this.tarPlayer=r;break}}return e++,!this.tarPlayer&&e<8?this.findOtherPlayer(e):this.tarPlayer}},{key:"canPostGoods",value:function(){return this.currCapacity/Number(this.conf.Capacity)*100>=Number(this.robotConfId.capacitylimit)}},{key:"addScore",value:function(e){this.currScore+=e,this.lvUp()}},{key:"lvUp",value:function(){if(this.currScore>=Number(this.conf.Score)&&this.lv<cc.res.loads.conf_player.length){this.initConf(this.lv+1),(this.isPlayerSelf||this.isRobot)&&this.addFollowPlayer(),this.showEmoji("lvup");var e=cc.res.getObjByPool("prefab_anim_ParLvUp");e.parent=this.node,e.setPosition(cc.v3(0,-.9,0)),this.scheduleOnce((function(){e.destroy()}),2)}}},{key:"addFollowPlayer",value:function(){for(var e=this.follow.length;e<Number(this.conf.PlayerNum)-1;e++){var t=this.gameControl.addPlayerFollow(this);this.follow.push(t)}cc.log(this.lv,this.conf.PlayerNum)}},{key:"collPlayer",value:function(e){if(this.isCanColl){this.isCanColl=!1;var i=this.node.getPosition(),o=e.node.getPosition(),s=cc.v2(i.x,i.z).subtract(cc.v2(o.x,o.z)).normalize(),a=0;0==this.moveDir.x&&0==this.moveDir.y||(a=this.moveDir.signAngle(s)),s.rotate((Math.random()-.5)*a),i.x+=.3*s.x,i.z+=.3*s.y,this.moveDir=s,this.isColl=!0;var r=this;this.updateDir(cc.v2(-s.x,-s.y));var n=e.node.getComponent(t);n&&n.lv>this.lv?(r.scheduleOnce((function(){r.isColl=!1,r.scheduleOnce((function(){r.isCanColl=!0}),1)}),1),this.hurt(),this.isPlayerSelf&&(cc.sdk.vibrate(!0),cc.log("coll my player"))):(r.scheduleOnce((function(){r.isColl=!1,r.scheduleOnce((function(){r.isCanColl=!0}),1)}),.1),this.node.emit("excAi"),this.isPlayerSelf&&(cc.sdk.vibrate(),cc.log("coll my player2")))}}},{key:"judgeColl",value:function(e){var t=!0;if(null==this.followTarget){for(var i=0;i<this.follow.length;i++)if(this.follow[i].node==e.node){t=!1;break}}else if(this.followTarget.node==e.node&&(t=!1),t)for(i=0;i<this.followTarget.follow.length;i++)if(this.followTarget.follow[i].node==e.node){t=!1;break}return t}},{key:"collEnter",value:function(e){"player"==e.node.name?this.judgeColl(e)&&this.collPlayer(e):-1!=this.gameControl.goodsNames.indexOf(e.node.name)?"run"==this.state&&this.holdGoods(e.node.getComponent(h)):e.node.name==this.gameControl.cashier.name&&this.postGoods(),this.currCollNode=e.node}},{key:"updateStep",value:function(e){this.isColl||(this.isMove?(this.run(),this.updateDir(this.moveDir),0==this.moveDir.x&&0==this.moveDir.y||this.gcoll.applyForce(cc.v2(this.moveDir).multiplyScalar(this.moveSpeed*Number(this.conf.Speed)))):(this.idle(),this.gcoll.applyForce(cc.v2(0,0)))),this.updateNick()}},{key:"updateNick",value:function(){var e=cc.pipelineUtils.WorldNode3DToWorldNodeUI(this.gameControl.camera,this.nickNode.getWorldPosition(),this.gameControl.gameUI),t=Math.abs(this.gameControl.camera.node.getWorldPosition().z-this.node.getWorldPosition().z);this.uiNick.setWorldPosition(e);var i=10/t;i>1&&(i=1),this.uiNick.setScale(i,i,1)}}]),t}(o))||f)),cc._RF.pop()}}})),System.register("project:///assets/script/game/Robot.ts",["cc","./Player.ts","../tools/Astar.ts"],(function(e,t){var i,o,s,a,r,n;return e({_dec:void 0,_class:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator},function(e){o=e.Player},function(e){s=e.Astar}],execute:function(){cc._RF.push(window.module||{},"361f2+eXNlBcbnFCBo45FwF","Robot"),n=i.ccclass,i.property,e("Robot",(a=n("Robot"),a(r=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)))).roadList=[],i.isExcAi=!1,i.robotState="idle",i.toWanderTime=0,i.toIdleTime=0,i.roadListTime=0,i.toPostGoodsTime=0,i.toRobTime=0,i.toAvoidTime=0,i.updateDirTime=1,i.toHoldGoodsNum=0,i.ai2Dt=0,i.findGoodsState=0,i.robotConfPathId=-1,i.removePath=[],i.isCanRmovePath=!1,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.isRobot=!0,babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"start",this).call(this),this.node.on("excAi",this.excAi.bind(this),this)}},{key:"onDestroy",value:function(){this.node.off("excAi",this.excAi.bind(this),this)}},{key:"excAi",value:function(){this.isExcAi=!0}},{key:"updateMoveDir",value:function(e){if(!this.isColl){var t=this.node.getPosition();if("toHoldGoods"==this.robotState)if(cc.isValid(this.tarGoods)&&this.toHoldGoodsNum<6){this.toHoldGoodsTime+=e;var i=this.tarGoods.getPosition();cc.Vec2.distance(cc.v2(i.x,i.y),cc.v2(t.x,t.z))>.05&&this.toHoldGoodsTime>.25&&(this.moveDir=cc.v2(i.x,i.z).subtract(cc.v2(t.x,t.z)).normalize()),this.toHoldGoodsTime>.5&&(this.toHoldGoodsNum++,this.toHoldGoodsTime=0,this.moveDir.rotate((Math.random()-.5)*(Math.PI+Math.PI/4)),this.canPostGoods()&&this.excAi())}else if(this.roadList.length>0){var o=this.roadList[0];(cc.Vec2.distance(cc.v2(o.x,o.y),cc.v2(t.x,t.z))<.2||this.roadListTime>2)&&(this.roadList.shift(),this.roadList.length>0&&(o=this.roadList[0],cc.Vec2.distance(cc.v2(o.x,o.y),cc.v2(t.x,t.z))<.2&&(this.roadList.shift(),this.roadList.length>0&&(o=this.roadList[0]))),this.roadListTime=0,cc.isValid(this.tarGoods)||(this.findGoodsState=1,this.toHoldGoodsNum=0),this.canPostGoods()&&this.excAi(),this.moveDir=cc.v2(o.x,o.y).subtract(cc.v2(t.x,t.z)).normalize()),this.updateDirTime>.05&&(this.updateDirTime=0,this.moveDir=cc.v2(o.x,o.y).subtract(cc.v2(t.x,t.z)).normalize()),this.roadListTime+=e,this.toHoldGoodsTime=0}else this.toHoldGoodsTime+=e,this.toHoldGoodsTime>1?this.excAi():(this.isCanRmovePath&&this.robotConfPath.length>1&&!cc.isValid(this.tarGoods)&&(this.isCanRmovePath=!1,this.removePath.push(this.robotConfPath[this.robotConfPathId]),this.robotConfPath.splice(this.robotConfPathId,1)),cc.isValid(this.tarGoods)||(this.findGoodsState=1,this.toHoldGoodsNum=0));else if("toWander"==this.robotState)this.toWanderTime+=e,Math.random()<.05&&(this.moveDir=cc.v2(Math.random()-.5,Math.random()-.5).normalize()),this.toWanderTime>Number(this.robotConfId.wandertime)/2&&this.excAi();else if("toPostGoods"==this.robotState)if(this.roadList.length>0){o=this.roadList[0];(cc.Vec2.distance(cc.v2(o.x,o.y),cc.v2(t.x,t.z))<.2||this.roadListTime>2)&&(this.roadList.shift(),this.roadList.length>0&&(o=this.roadList[0],cc.Vec2.distance(cc.v2(o.x,o.y),cc.v2(t.x,t.z))<.2&&(this.roadList.shift(),this.roadList.length>0&&(o=this.roadList[0]))),this.roadListTime=0,this.moveDir=cc.v2(o.x,o.y).subtract(cc.v2(t.x,t.z)).normalize()),this.updateDirTime>.05&&(this.updateDirTime=0,this.moveDir=cc.v2(o.x,o.y).subtract(cc.v2(t.x,t.z)).normalize()),this.roadListTime+=e}else this.toPostGoodsTime+=e,this.toPostGoodsTime>1&&this.excAi();else if("toRob"==this.robotState){if(cc.isValid(this.tarPlayer)){i=this.tarPlayer.node.getPosition();this.moveDir=cc.v2(i.x,i.z).subtract(cc.v2(t.x,t.z)).normalize()}this.toRobTime+=e,this.toRobTime>2&&this.excAi()}else if("toAvoid"==this.robotState){if(cc.isValid(this.tarPlayer)){i=this.tarPlayer.node.getPosition();this.moveDir=cc.v2(i.x,i.z).subtract(cc.v2(t.x,t.z)).normalize().multiplyScalar(-1)}this.toAvoidTime+=e,this.toAvoidTime>2&&this.excAi()}"toIdle"==this.robotState?(this.isMove=!1,this.toIdleTime+=e,this.toIdleTime>3&&this.excAi()):this.isMove=!0}}},{key:"findRoad",value:function(e){var t=cc.v3(this.node.getPosition()),i=null;if(cc.isValid(this.currCollNode)){var o=this.currCollNode.getPosition();i=cc.v2(o.x,o.z)}(new Date).getTime();var a=new s;a.findPath({x:t.x,y:t.z},{x:e.x,y:e.y},i),this.roadList=a.pathList,this.isCanRmovePath=a.isFind}},{key:"getCurrVec",value:function(){var e=cc.v3(this.node.getPosition());return e.x-=1.2*this.moveDir.x,e.z-=1.2*this.moveDir.y,e}},{key:"ai",value:function(){if(100*Math.random()<=Number(this.robotConflv.pay)&&this.canPostGoods())this.robotState="toPostGoods",this.findRoad(cc.v2(0,7)),this.toPostGoodsTime=0;else if(100*Math.random()<=Number(this.robotConflv.collect)+Number(this.robotConfId.collect)){this.robotState="toHoldGoods";var e=null;this.robotConfPath.length>0?(this.robotConfPathId=this.robotConfPath.length-1,e=this.robotConfPath[this.robotConfPathId]):(this.robotConfPathId=Math.floor(Math.random()*this.removePath.length),e=this.removePath[this.robotConfPathId]),this.findRoad(cc.v2(e.x,e.y)),this.toHoldGoodsTime=0,this.findGoodsState=0,this.tarGoods=null}else 100*Math.random()<=Number(this.robotConflv.wander)+Number(this.robotConfId.wander)?(this.robotState="toWander",this.toWanderTime=0):(this.robotState="toIdle",this.idle(),this.toIdleTime=0)}},{key:"ai2",value:function(){var e;"toRob"!=this.robotState&&"toAvoid"!=this.robotState&&("toPostGoods"!=this.robotState?(e=this.findOtherPlayer(0))&&(this.lv>e.lv&&100*Math.random()<=Number(this.robotConfId.rob)+50&&e.currCapacity>0&&this.currCapacity<=Number(this.conf.Capacity)&&(this.toRobTime=0,this.robotState="toRob",this.showEmoji("attack")),"toRob"!=this.robotState&&this.lv<e.lv&&100*Math.random()<=Number(this.robotConfId.avoid)&&(this.toAvoidTime=0,this.robotState="toAvoid")):(e=this.findOtherPlayer(0))&&this.lv<e.lv&&100*Math.random()<=Number(this.robotConfId.avoid)&&(this.toAvoidTime=0,this.robotState="toAvoid"))}},{key:"update",value:function(e){this.gameControl.isStart?(this.updateMoveDir(e),this.updateStep(e)):(this.isMove=!1,this.idle())}},{key:"lateUpdate",value:function(e){this.gameControl.isStart&&(this.isExcAi&&(this.isExcAi=!1,this.ai()),1==this.findGoodsState&&(this.findGoodsState=2,this.findCanHoldGoods(0)),this.ai2Dt+=e,this.ai2Dt>.1&&(this.ai2Dt=0,this.ai2()))}}]),t}(o))||r)),cc._RF.pop()}}})),System.register("project:///assets/script/game/gameControl.ts",["cc","./Player.ts","./Goods.ts","./Robot.ts","./PlayerFollow.ts","../GColl/GBoxColl.ts","../res.ts","../config.ts"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b,m,g,v,y,C,x,S,w,k,P,_,N,z,H,D,M,I;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_dec4:void 0,_dec5:void 0,_dec6:void 0,_dec7:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_descriptor3:void 0,_descriptor4:void 0,_descriptor5:void 0,_descriptor6:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Node,a=e.LabelComponent,r=e.ProgressBarComponent,n=e.CameraComponent,l=e.AnimationComponent},function(e){c=e.Player},function(e){d=e.Goods},function(e){h=e.Robot},function(e){u=e.PlayerFollow},function(e){p=e.GBoxColl},function(e){f=e.res},function(e){b=e.config}],execute:function(){cc._RF.push(window.module||{},"55440slItJJIKzMTI22N2gJ","gameControl"),M=i.ccclass,I=i.property,e("gameControl",(m=M("gameControl"),g=I(c),v=I(s),y=I(n),C=I(s),x=I(s),S=I(a),m((k=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"playerSc",P,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"goodsNode",_,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"camera",N,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"gameUI",z,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"loadNode",H,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"timeLabel",D,babelHelpers.assertThisInitialized(i)),i.cashier=null,i.loadPro=null,i.proTxt=null,i.goodss=[],i.players=[],i.num=0,i.goodsNames="",i.colors=["#FF5200","#00ffd8","#fc00ff","#00ff18","#9cff00","#FFFFFF"],i.gameTime=0,i.gameScore=0,i.gameMode=1,i.goodsToalNum=0,i.holdGoodsNum=0,i.parentPre=[],i.upDt=1,i.score=0,i.isStart=!1,i.isCountDown=!1,i.isPlayCapacity=!1,i.isPlayPost=!1,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){cc.game.setFrameRate(30),this.gameMode=cc.storage.getStorage(cc.storage.mode),this.loadPro=cc.find("pro",this.loadNode).getComponent(r),this.proTxt=cc.find("pro/txt",this.loadNode).getComponent(a),this.loadNode.active=!0,this.gameUI.active=!1,this.gameTime=Number(cc.res.loads.conf_game[0].Time),this.gameScore=Number(cc.res.loads.conf_game[0].Score),this.updateTime(),b.astarmap=JSON.parse(JSON.stringify(b.astarmaps)),this.initMap(),this.playerSc.bodyColor=new cc.Color(this.colors[0]),cc.find("rank",this.gameUI).active=1==this.gameMode,cc.find("holdpro",this.gameUI).active=1!=this.gameMode}},{key:"updatePro",value:function(){var e=this.num/cc.res.loads.conf_map.length;this.loadPro.progress=e,this.proTxt.string="加载中..."+Math.floor(100*e)+"%",e>=1&&(this.loadNode.active=!1)}},{key:"updateTime",value:function(){this.timeLabel.string=cc.storage.fomatTime(1e3*this.gameTime,2),this.gameTime<=13&&!this.isCountDown&&(this.isCountDown=!0,f.openUI("countdown",null,2))}},{key:"initGoodsName",value:function(){for(var e=0;e<cc.res.loads.conf_goods.length;e++)this.goodsNames+=cc.res.loads.conf_goods[e].Prefab+":"}},{key:"initMap",value:function(){for(var e=0;this.num<cc.res.loads.conf_map.length;this.num++){var t=cc.res.loads.conf_map[this.num],i=cc.res.loads.conf_goods[t.id-1].Prefab,o=cc.res.loads.conf_goods[t.id-1].Parent,s=Number(cc.res.loads.conf_goods[t.id-1].Mass);if(this.score+=Number(cc.res.loads.conf_goods[t.id-1].Score),this.parentPre[o]||(this.parentPre[o]=cc.instantiate(f.loads["prefab_game_"+o])),this.parentPre[o]){var a=cc.instantiate(cc.find(i,this.parentPre[o]));if(!a){cc.log(i,this.parentPre[o]);continue}if(a.setWorldPosition(cc.v3(Number(t.x),Number(t.y),Number(t.z))),a.setWorldRotation(Number(t.rx),Number(t.ry),Number(t.rz),Number(t.rw)),this.goodsNode.addChild(a),this.goodss.push(a),s>=0){var r=a.addComponent(p);r.isCircle=!1,r.mass=s,s<1&&Number(t.y)<.1&&(r.isStatic=!1)}a.addComponent(d).initConf(t.id,t.c),-1!=i.indexOf("Res999")?this.cashier=a:(this.goodsNames+=i+":",this.goodsToalNum++)}if(++e>30)break}this.num<cc.res.loads.conf_map.length?(this.updatePro(),this.scheduleOnce(this.initMap.bind(this),.1)):(this.initRobot(),this.updatePro())}},{key:"initRobot",value:function(){var e=[cc.v2(1,1),cc.v2(1,5),cc.v2(-1,5),cc.v2(-4,3),cc.v2(-3,1),cc.v2(4,3),cc.v2(5,3),cc.v2(0,6)],t=0;1==this.gameMode&&(t=5);for(var i=0;i<t;i++){var o=Math.floor(Math.random()*e.length),s=e[o],a=cc.instantiate(f.loads.prefab_game_player);a.setPosition(cc.v3(s.x,0,s.y)),this.goodsNode.addChild(a);var r=a.addComponent(h);r.initConf(1),r.initRobotConf(15),r.initNick(this.randNick(),Math.floor(11*Math.random())),r.bodyColor=new cc.Color(this.colors[i+1]),this.players.push(r),e.splice(o,1)}s=e[Math.floor(Math.random()*e.length)];this.playerSc.node.setPosition(cc.v3(s.x,0,s.y)),cc.log(this.num),this.parentPre=[],f.openUI("countdown",null,1)}},{key:"randNick",value:function(){for(var e=b.nicks[Math.floor(Math.random()*b.nicks.length)],t=0;t<this.players.length;t++)if(this.players[t].nick==e)return this.randNick();return e}},{key:"addPlayerFollow",value:function(e){var t=e.node.getPosition(),i=cc.instantiate(f.loads.prefab_game_player);i.setPosition(cc.v3(.2*(Math.random()-.5)+t.x,0,.2*(Math.random()-.5)+t.z)),this.goodsNode.addChild(i);var o=i.addComponent(u);return o.initConf(e.lv),o.initNick(e.nick+"-追随者"),o.followTarget=e,o.bodyColor=e.bodyColor.clone(),o}},{key:"startCountDown",value:function(){this.isStart=!0;for(var e=0;e<this.players.length;e++)this.players[e].excAi();this.players.push(this.playerSc),this.gameUI.active=!0,this.updateHold(0)}},{key:"updateSelfCapacity",value:function(e){var t=cc.find("capacity",this.gameUI).getComponent(r),i=cc.find("capacity/label",this.gameUI).getComponent(a),o=cc.find("capacity/Bar",this.gameUI),s=cc.find("capacity/icon",this.gameUI);t.progress=e,i.string=Math.floor(100*e)+"%",e>.5&&e<=.8?f.setSpriteFrame("images/game/ProGameCapacity3/spriteFrame",o):e>.8?f.setSpriteFrame("images/game/ProGameCapacity2/spriteFrame",o):f.setSpriteFrame("images/game/ProGameCapacity1/spriteFrame",o),e>.8?(f.setSpriteFrame("images/game/ImgGameCapacity2/spriteFrame",s),this.isPlayCapacity||(s.getComponent(l).play(),this.isPlayCapacity=!0)):(f.setSpriteFrame("images/game/ImgGameCapacity1/spriteFrame",s),this.isPlayCapacity&&(s.getComponent(l).stop(),this.isPlayCapacity=!1))}},{key:"updateHold",value:function(e){if(1!=this.gameMode){this.holdGoodsNum+=e;var t=cc.find("holdpro",this.gameUI).getComponent(r),i=cc.find("holdpro/label",this.gameUI).getComponent(a);t.progress=this.holdGoodsNum/this.goodsToalNum,i.string=this.holdGoodsNum+"/"+this.goodsToalNum}}},{key:"updateRank",value:function(){if(1==this.gameMode){var e=cc.find("rank",this.gameUI).children;this.players.sort((function(e,t){return t.currScore-e.currScore}));for(var t=!1,i=0;i<e.length-1;i++){var o=e[i];if(i<this.players.length){var s=cc.find("lv",o).getComponent(a),r=cc.find("name",o).getComponent(a),n=cc.find("score",o).getComponent(a);s.string=i+1+"",r.string=cc.storage.getLabelStr(this.players[i].nick,14),n.string=this.players[i].currScore+"",this.playerSc,this.players[i],0==i?(this.players[i].currScore>=this.gameScore&&(t=!0),this.players[i].showKing(!0)):this.players[i].showKing(!1)}}o=e[e.length-1];var l=1;for(i=3;i<this.players.length;i++)if(this.playerSc==this.players[i]){l=i+1,this.playerSc.showKing(!1);break}s=cc.find("lv",o).getComponent(a),r=cc.find("name",o).getComponent(a),n=cc.find("score",o).getComponent(a);s.string=l+"",r.string=cc.storage.getLabelStr(this.playerSc.nick,14),n.string=this.playerSc.currScore+"",t&&this.gameOver()}}},{key:"playPostAni",value:function(){if(!this.isPlayPost){this.isPlayPost=!0,this.cashier.getComponent(l).play();var e=this;this.scheduleOnce((function(){e.isPlayPost=!1}),.5)}}},{key:"gameOver",value:function(){this.isStart=!1,1==this.gameMode?f.openUI("jiesuan"):f.openUI("jiesuan2")}},{key:"update",value:function(e){this.isStart&&(this.gameTime-=e,this.upDt+=e,this.upDt>=1&&(this.upDt=0,this.updateTime(),this.updateRank(),this.gameTime<0&&this.gameOver()))}}]),t}(o),P=babelHelpers.applyDecoratedDescriptor(k.prototype,"playerSc",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=babelHelpers.applyDecoratedDescriptor(k.prototype,"goodsNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=babelHelpers.applyDecoratedDescriptor(k.prototype,"camera",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=babelHelpers.applyDecoratedDescriptor(k.prototype,"gameUI",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=babelHelpers.applyDecoratedDescriptor(k.prototype,"loadNode",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=babelHelpers.applyDecoratedDescriptor(k.prototype,"timeLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=k))||w)),cc._RF.pop()}}})),System.register("project:///assets/script/GColl/GCollControl.ts",["cc"],(function(e,t){var i,o,s,a,r,n,l,c,d,h;return e({_dec:void 0,_dec2:void 0,_class:void 0,_class2:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.PhysicsSystem}],execute:function(){cc._RF.push(window.module||{},"b349dZjDT1E0JzyHJjZtDkP","GCollControl"),d=i.ccclass,i.property,h=i.executionOrder,e("GCollControl",(a=d("GCollControl"),r=h(-1),a(n=r((c=l=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)))).maps={},i.roads={},i.collMindis=1,i.index=0,i.collList=[],i.updt=0,i.collNum=0,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"onLoad",value:function(){t.ins=this,s.instance.enable=!1,s.instance.maxSubStep=1,s.instance.deltaTime=1/30,this.roads={}}},{key:"add",value:function(e){e&&this.collList.push(e)}},{key:"update",value:function(e){this.maps={},this.collNum=0}}]),t}(o),l.ins=null,n=c))||n)||n)),cc._RF.pop()}}})),System.register("project:///assets/script/game/mainControl.ts",["cc","./Player.ts","./Robot.ts","../res.ts","../storage.ts"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b,m,g,v,y,C,x,S,w,k,P,_,N,z,H,D,M,I,T,R,L,O,A,F,G,q,U,B,j;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_dec4:void 0,_dec5:void 0,_dec6:void 0,_dec7:void 0,_dec8:void 0,_dec9:void 0,_dec10:void 0,_dec11:void 0,_dec12:void 0,_dec13:void 0,_dec14:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_descriptor3:void 0,_descriptor4:void 0,_descriptor5:void 0,_descriptor6:void 0,_descriptor7:void 0,_descriptor8:void 0,_descriptor9:void 0,_descriptor10:void 0,_descriptor11:void 0,_descriptor12:void 0,_descriptor13:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Node,a=e.LabelComponent,r=e.ProgressBarComponent,n=e.ButtonComponent,l=e.AnimationComponent},function(e){c=e.Player},function(e){d=e.Robot},function(e){h=e.res},function(e){u=e.storage}],execute:function(){cc._RF.push(window.module||{},"ccf28gONRhDkLODhrKxDmt8","mainControl"),B=i.ccclass,j=i.property,e("mainControl",(p=B("mainControl"),f=j(s),b=j(s),m=j(s),g=j(a),v=j(a),y=j(a),C=j(r),x=j(a),S=j(n),w=j(n),k=j(n),P=j(s),_=j(c),p((z=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"goodsNode",H,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"vibrateNode",D,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"musicNode",M,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"coinLabel",I,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"starlvLabel",T,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"starexpLabel",R,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"starPro",L,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"maxscoreLabel",O,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"speedUp",A,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"lixianUp",F,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"capacityUp",G,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"startNode",q,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"playerSc",U,babelHelpers.assertThisInitialized(i)),i.upDt=0,i.score=0,i.num=0,i.parentPre=[],i.coin=0,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){cc.game.setFrameRate(30),this.initMap(),this.initUI(),this.updateUI(),this.updateSpeedUp(),this.updateCapacityUp(),this.updateLixianUp(),this.scheduleOnce(this.judgeSkin.bind(this),.2),cc.GAME.judgeLixian&&(cc.GAME.judgeLixian=!1,this.updateLixian(),this.scheduleOnce((function(){cc.sdk.videoLoad()}),.3)),cc.audio.playMusic("audio/music")}},{key:"initUI",value:function(){var e=cc.storage.getStorage(cc.storage.skinid);this.playerSc.initNick("留个名吧",e),this.playerSc.bodyColor=new cc.Color("#FF5200"),u.getStorage(u.music)?cc.res.setSpriteFrame("images/main/BtnMusicOn/spriteFrame",this.musicNode):cc.res.setSpriteFrame("images/main/BtnMusicOff/spriteFrame",this.musicNode)}},{key:"updateSkin",value:function(){var e=cc.storage.getStorage(cc.storage.skinid);this.playerSc.initNick("留个名吧",e),this.playerSc.initSkin()}},{key:"updateLixian",value:function(){this.scheduleOnce((function(){h.openUI("lixian")}),1)}},{key:"updateUI",value:function(){this.updateCoin(),this.updateMode();var e=u.getStorage(u.starlv),t=u.getStorage(u.starexp);this.starlvLabel.string=e;var i=null;e<cc.res.loads.conf_starlv.length&&(i=cc.res.loads.conf_starlv[e-1]),i&&(this.starPro.progress=t/Number(i.experience),this.starexpLabel.string=t+"/"+i.experience)}},{key:"updateCoin",value:function(){this.coin=u.getStorage(u.coin),this.coinLabel.string=u.castNum(this.coin)}},{key:"updateMode",value:function(){1==u.getStorage(u.mode)?(this.maxscoreLabel.string="最高分："+u.getStorage(u.maxscore),h.setSpriteFrame("images/main/BtnGame1/spriteFrame",this.startNode)):(this.maxscoreLabel.string="最高分："+u.getStorage(u.maxscore2),h.setSpriteFrame("images/main/BtnGame2/spriteFrame",this.startNode))}},{key:"updateSpeedUp",value:function(){var e=cc.find("add",this.speedUp.node).getComponent(a),t=cc.find("coinbg/num",this.speedUp.node).getComponent(a),i=cc.find("tishi",this.speedUp.node),o=(cc.find("ad",this.speedUp.node),u.getStorage(u.speedlv)),s=cc.res.loads.conf_playerlv[o],r=null;o+1<cc.res.loads.conf_playerlv.length&&(r=cc.res.loads.conf_playerlv[o+1]),e.string="速度+"+s.speed,r?(t.string=u.castNum(r.speedcost),i.active=this.coin>=Number(r.speedcost)):(t.string="0",i.active=!1)}},{key:"toSpeedUp",value:function(){var e=u.getStorage(u.speedlv);if(e+1>=cc.res.loads.conf_playerlv.length)h.showToast("等级已满");else{var t=cc.res.loads.conf_playerlv[e+1];this.coin<Number(t.speedcost)?h.showToast("金币不足"):(u.setStorage(u.coin,this.coin-Number(t.speedcost)),u.setStorage(u.speedlv,e+1),u.uploadStorage(u.coin),u.uploadStorage(u.speedlv),this.updateCoin(),this.updateSpeedUp(),this.updateCapacityUp(),this.updateLixianUp(),cc.find("ani",this.speedUp.node).getComponent(l).play())}}},{key:"updateCapacityUp",value:function(){var e=cc.find("add",this.capacityUp.node).getComponent(a),t=cc.find("coinbg/num",this.capacityUp.node).getComponent(a),i=cc.find("tishi",this.capacityUp.node),o=(cc.find("ad",this.capacityUp.node),u.getStorage(u.capacitylv)),s=cc.res.loads.conf_playerlv[o],r=null;o+1<cc.res.loads.conf_playerlv.length&&(r=cc.res.loads.conf_playerlv[o+1]),e.string="容量+"+s.capacity,r?(t.string=u.castNum(r.capacitycost),i.active=this.coin>=Number(r.capacitycost)):(t.string="0",i.active=!1)}},{key:"toCapacityUp",value:function(){var e=u.getStorage(u.capacitylv);if(e+1>=cc.res.loads.conf_playerlv.length)h.showToast("等级已满");else{var t=cc.res.loads.conf_playerlv[e+1];this.coin<Number(t.capacitycost)?h.showToast("金币不足"):(u.setStorage(u.coin,this.coin-Number(t.capacitycost)),u.setStorage(u.capacitylv,e+1),u.uploadStorage(u.coin),u.uploadStorage(u.capacitylv),this.updateCoin(),this.updateSpeedUp(),this.updateCapacityUp(),this.updateLixianUp(),cc.find("ani",this.capacityUp.node).getComponent(l).play())}}},{key:"updateLixianUp",value:function(){var e=cc.find("add",this.lixianUp.node).getComponent(a),t=cc.find("coinbg/num",this.lixianUp.node).getComponent(a),i=cc.find("tishi",this.lixianUp.node),o=(cc.find("ad",this.lixianUp.node),u.getStorage(u.lixianlv)),s=cc.res.loads.conf_playerlv[o],r=null;o+1<cc.res.loads.conf_playerlv.length&&(r=cc.res.loads.conf_playerlv[o+1]),e.string=s.offline+"/分钟",r?(t.string=u.castNum(r.offlinecost),i.active=this.coin>=Number(r.offlinecost)):(t.string="0",i.active=!1)}},{key:"toLixianUp",value:function(){var e=u.getStorage(u.lixianlv);if(e+1>=cc.res.loads.conf_playerlv.length)h.showToast("等级已满");else{var t=cc.res.loads.conf_playerlv[e+1];this.coin<Number(t.offlinecost)?h.showToast("金币不足"):(u.setStorage(u.coin,this.coin-Number(t.offlinecost)),u.setStorage(u.lixianlv,e+1),u.uploadStorage(u.coin),u.uploadStorage(u.lixianlv),this.updateCoin(),this.updateSpeedUp(),this.updateCapacityUp(),this.updateLixianUp(),cc.find("ani",this.lixianUp.node).getComponent(l).play())}}},{key:"judgeSkin",value:function(){var e=u.getStorage(u.hasskin);e||(e=[]);var t=!1;-1==u.indexOf(e,1)&&(u.getStorage(u.loginday)>0&&e.push(1),t=!0);-1==u.indexOf(e,2)&&(u.getStorage(u.loginday)>=7&&e.push(2),t=!0);-1==u.indexOf(e,3)&&(u.getStorage(u.modewinnum)>=1&&e.push(3),t=!0);-1==u.indexOf(e,4)&&(u.getStorage(u.maxscore)>=2e3&&e.push(4),t=!0);-1==u.indexOf(e,5)&&(u.getStorage(u.maxscore)>=2500&&e.push(5),t=!0);-1==u.indexOf(e,6)&&(u.getStorage(u.modewinnum)>=3&&e.push(6),t=!0);-1==u.indexOf(e,7)&&(u.getStorage(u.starlv)>=5&&e.push(7),t=!0);-1==u.indexOf(e,8)&&(u.getStorage(u.starlv)>=6&&e.push(8),t=!0);-1==u.indexOf(e,9)&&(u.getStorage(u.starlv)>=7&&e.push(9),t=!0);-1==u.indexOf(e,10)&&(u.getStorage(u.starlv)>=8&&e.push(10),t=!0);t&&(u.setStorage(u.hasskin,e),u.uploadStorage(u.hasskin))}},{key:"initMap",value:function(){for(var e=0;this.num<cc.res.loads.conf_maptitle.length;this.num++){var t=cc.res.loads.conf_maptitle[this.num],i=cc.res.loads.conf_goods[t.id-1].Prefab,o=cc.res.loads.conf_goods[t.id-1].Parent;if(this.parentPre[o]||(this.parentPre[o]=cc.instantiate(h.loads["prefab_game_"+o])),this.parentPre[o]){var s=cc.instantiate(cc.find(i,this.parentPre[o]));if(!s){cc.log(i,this.parentPre[o]);continue}s.setWorldPosition(cc.v3(Number(t.x),Number(t.y),Number(t.z))),s.setWorldRotation(Number(t.rx),Number(t.ry),Number(t.rz),Number(t.rw)),this.goodsNode.addChild(s)}if(++e>30)break}this.num<cc.res.loads.conf_maptitle.length?this.scheduleOnce(this.initMap.bind(this),.01):this.initRobot()}},{key:"initRobot",value:function(){for(var e=0;e<0;e++){var t=cc.instantiate(h.loads.prefab_game_player);t.setPosition(cc.v3(10*(Math.random()-.5),0,15*(Math.random()-.5))),this.goodsNode.addChild(t);var i=t.addComponent(d);i.initConf(1),i.initRobotConf(15)}}},{key:"click",value:function(e,t){if("start"==t)cc.director.loadScene("game");else if("mode"==t)h.openUI("modesel");else if("skin"==t)h.openUI("skin");else if("vibrate"==t){var i=u.getStorage(u.vibrate);u.setStorage(u.vibrate,1==i?0:1),i?cc.res.setSpriteFrame("images/main/BtnShakeOff/spriteFrame",this.vibrateNode):cc.res.setSpriteFrame("images/main/BtnShakeOn/spriteFrame",this.vibrateNode)}else if("music"==t){var o=u.getStorage(u.music);u.setStorage(u.music,1==o?0:1),o?cc.res.setSpriteFrame("images/main/BtnMusicOff/spriteFrame",this.musicNode):cc.res.setSpriteFrame("images/main/BtnMusicOn/spriteFrame",this.musicNode),o?cc.audio.pauseMusic():cc.audio.resumeMusic()}else"speedUp"==t?this.toSpeedUp():"capacityUp"==t?this.toCapacityUp():"lixianUp"==t&&this.toLixianUp();cc.audio.playSound("audio/button")}}]),t}(o),H=babelHelpers.applyDecoratedDescriptor(z.prototype,"goodsNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=babelHelpers.applyDecoratedDescriptor(z.prototype,"vibrateNode",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=babelHelpers.applyDecoratedDescriptor(z.prototype,"musicNode",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=babelHelpers.applyDecoratedDescriptor(z.prototype,"coinLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=babelHelpers.applyDecoratedDescriptor(z.prototype,"starlvLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=babelHelpers.applyDecoratedDescriptor(z.prototype,"starexpLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=babelHelpers.applyDecoratedDescriptor(z.prototype,"starPro",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=babelHelpers.applyDecoratedDescriptor(z.prototype,"maxscoreLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=babelHelpers.applyDecoratedDescriptor(z.prototype,"speedUp",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=babelHelpers.applyDecoratedDescriptor(z.prototype,"lixianUp",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=babelHelpers.applyDecoratedDescriptor(z.prototype,"capacityUp",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=babelHelpers.applyDecoratedDescriptor(z.prototype,"startNode",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=babelHelpers.applyDecoratedDescriptor(z.prototype,"playerSc",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=z))||N)),cc._RF.pop()}}})),System.register("project:///assets/script/GColl/GBoxColl.ts",["cc","./GCollControl.ts","../game/Player.ts","../config.ts"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b,m,g,v,y;return e({_dec:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_descriptor3:void 0,_descriptor4:void 0,_descriptor5:void 0,_descriptor6:void 0,_descriptor7:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.ModelComponent},function(e){a=e.GCollControl},function(e){r=e.Player},function(e){n=e.config}],execute:function(){cc._RF.push(window.module||{},"f2f21cSjgBJKK94CjGo1yB+","GBoxColl"),v=i.ccclass,y=i.property,e("GBoxColl",(l=v("GBoxColl"),l((d=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"width",h,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"height",u,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"isStatic",p,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"mass",f,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"damping",b,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"elastic",m,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"isCircle",g,babelHelpers.assertThisInitialized(i)),i.velocity=cc.v2(0,0),i.elasticVelocity=cc.v2(0,0),i.collDis=1,i.lastColl=!1,i.collcallback=null,i.mesh=null,i.zOffset=0,i.xOffset=0,i.rigid=null,i.collider=null,i.upCollDt=0,i.isOpenColl=!0,i.isRobot=!1,i.isPlayer=!1,i.canColl=!1,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.collDis=a.ins.collMindis;var e=this.findMesh(this.node);this.mesh=e,this.initWh();var t=this;this.scheduleOnce((function(){"player"==t.node.name&&(t.isRobot=t.node.getComponent(r).isRobot,t.isPlayer=!0)}),1),this.isStatic&&this.mass>1&&this.node.getPosition().y<.1&&(this.canColl=!0)}},{key:"initWh",value:function(){if(this.mesh&&(this.width=this.mesh.maxPosition.x-this.mesh.minPosition.x,this.height=this.mesh.maxPosition.z-this.mesh.minPosition.z,!this.isCircle)){var e=this.node.getWorldRotation().y;if(Math.abs(e)>.1&&Math.abs(e)<.9){var t=this.width,i=this.height;this.width=i,this.height=t}var o=this.node.getWorldRotation().x;if(o>.1&&o<.9){if(this.width=this.mesh.maxPosition.x-this.mesh.minPosition.x,this.height=this.mesh.maxPosition.y-this.mesh.minPosition.y,this.zOffset=this.height/2,e>.1&&e<.9){t=this.width,i=this.height;this.width=i,this.height=t,this.xOffset=this.width/2,this.zOffset=0}else if(e>-.9&&e<-.1){t=this.width,i=this.height;this.width=i,this.height=t,this.xOffset=-this.width/2,this.zOffset=0}}else if(o>-.9&&o<-.1)if(this.width=this.mesh.maxPosition.x-this.mesh.minPosition.x,this.height=this.mesh.maxPosition.y-this.mesh.minPosition.y,this.zOffset=-this.height/2,e>.1&&e<.9){t=this.width,i=this.height;this.width=i,this.height=t,this.xOffset=-this.width/2,this.zOffset=0}else if(e>-.9&&e<-.1){t=this.width,i=this.height;this.width=i,this.height=t,this.xOffset=this.width/2,this.zOffset=0}this.width+=.2,this.height+=.2}"player"==this.node.name?(this.width=.5,this.height=.5):-1!=this.node.name.indexOf("Wall03")&&(this.width+=.2,this.height+=.2)}},{key:"findMesh",value:function(e){var t=e.getComponent(s);if(t)return t.mesh;for(var i=e.children,o=0;o<i.length;o++)return this.findMesh(i[o]);return null}},{key:"applyForce",value:function(e){this.velocity=e}},{key:"getNextPos",value:function(e){var t=this.getAllVec(),i=this.node.getPosition();return i.x+=e*t.x,i.z+=e*t.y,i.x>14&&(i.x=14),i.x<-14&&(i.x=-14),i.z>7.5&&(i.z=7.5),i.z<-7.5&&(i.z=-7.5),i}},{key:"getNextPosByDir",value:function(e,t){var i=e,o=this.node.getPosition();return o.x+=t*i.x,o.z+=t*i.y,o.x>14&&(o.x=14),o.x<-14&&(o.x=-14),o.z>7.5&&(o.z=7.5),o.z<-7.5&&(o.z=-7.5),o}},{key:"getLastPos",value:function(e){var t=this.getAllVec(),i=this.node.getPosition();return i.x-=e*t.x*.01,i.z-=e*t.y*.01,i}},{key:"getAllVec",value:function(){return cc.v2(this.velocity).add(this.elasticVelocity)}},{key:"setCollcallback",value:function(e){this.collcallback=e}},{key:"excCallback",value:function(e){this.collcallback&&this.collcallback(e)}},{key:"judgeColl3",value:function(e){var t=this.node.getPosition(),i=this.getNextPos(e);if("player"==this.node.name)for(var o=this.excColl(i,t),s=0;s<o.length;s++){var a=o[s].collItem,r=o[s];this.excCallback(a),a.excCallback(this);var l=cc.v2(this.velocity).normalize().subtract(cc.v2(a.velocity).normalize());if(this.velocity=this.velocity.subtract(cc.v2(l).multiplyScalar(.5*a.velocity.length())),!a.isStatic){var c=this.mass/a.mass;(c>2||a.isPlayer)&&(c=2),a.velocity=cc.v2(this.velocity).multiplyScalar(c)}if(!r.box){var d=r.dir.multiplyScalar(r.mdis);i.x+=d.x,i.z+=d.y}}var h=n.converToNodePos(cc.v2(i.x,i.z));if(n.astarmap[h.y][h.x])t=i;else if(Math.abs(this.velocity.x)>Math.abs(this.velocity.y)){var u=n.converToNodePos(cc.v2(i.x,t.z));if(n.astarmap[u.y][u.x]&&(t.x=i.x),i.x!=t.x){u=n.converToNodePos(cc.v2(t.x,i.z));n.astarmap[u.y][u.x]&&(t.z=i.z)}}else{u=n.converToNodePos(cc.v2(t.x,i.z));if(n.astarmap[u.y][u.x]&&(t.z=i.z),i.z!=t.z){u=n.converToNodePos(cc.v2(i.x,t.z));n.astarmap[u.y][u.x]&&(t.x=i.x)}}this.node.setPosition(t)}},{key:"judgeColl",value:function(e){for(var t=this.node.getPosition(),i=this.getNextPos(e),o=this.excColl(i,t),s=0,a=0,r=0,n=0;n<o.length;n++){var l=o[n].collItem,c=o[n];this.excCallback(l),l.excCallback(this);var d=cc.v2(this.velocity).normalize().subtract(cc.v2(l.velocity).normalize());if(this.velocity=this.velocity.subtract(cc.v2(d).multiplyScalar(.5*l.velocity.length())),!l.isStatic){var h=this.mass/l.mass;(h>2||l.isPlayer)&&(h=2),l.velocity=cc.v2(this.velocity).multiplyScalar(h)}if(c.box){(p=Math.min(c.box.width,c.box.height))>0&&l.canColl&&(r++,s+=c.box.width,a+=c.box.height)}else{var u=c.dir.multiplyScalar(c.mdis);i.x+=u.x,i.z+=u.y}}var p;if((p=Math.min(s,a))>0){var f=this.velocity.length(),b=cc.v2(this.velocity).normalize();b.x<0?b.x=-.5:b.x=.5;var m=this.getNextPosByDir(cc.v2(b.x,0).multiplyScalar(f),e),g=this.excColl(m,t),v=!1;for(n=0;n<g.length;n++){if((l=g[n].collItem).canColl){v=!0;break}}if(v){v=!1,b.y<0?b.y=-.5:b.y=.5,m=this.getNextPosByDir(cc.v2(0,b.y).multiplyScalar(f),e);for(g=this.excColl(m,t),n=0;n<g.length;n++){if((l=g[n].collItem).canColl){v=!0;break}}}if(v)if(p>.1&&r>=1)for(n=0;n<o.length;n++){if((l=o[n].collItem).canColl){c=o[n];var y=cc.v2(c.box.x+c.box.width/2,c.box.y+c.box.height/2);b=cc.v2(t.x,t.z).subtract(y).normalize(),i.x+=b.x*c.box.width/2,i.z+=b.y*c.box.height/2;break}}else i=t;else i=m}this.node.setPosition(i)}},{key:"excColl",value:function(e,t){var i=this.collDis,o=[];o.push(Math.round(e.x)+"_"+Math.round(e.z)),o.push(Math.round(e.x+i)+"_"+Math.round(e.z+i)),o.push(Math.round(e.x-i)+"_"+Math.round(e.z-i)),o.push(Math.round(e.x+i)+"_"+Math.round(e.z-i)),o.push(Math.round(e.x-i)+"_"+Math.round(e.z+i)),o.push(Math.round(e.x)+"_"+Math.round(e.z+i)),o.push(Math.round(e.x+i)+"_"+Math.round(e.z)),o.push(Math.round(e.x-i)+"_"+Math.round(e.z)),o.push(Math.round(e.x)+"_"+Math.round(e.z-i)),i=this.collDis+1,o.push(Math.round(e.x+i)+"_"+Math.round(e.z+i)),o.push(Math.round(e.x-i)+"_"+Math.round(e.z-i)),o.push(Math.round(e.x+i)+"_"+Math.round(e.z-i)),o.push(Math.round(e.x-i)+"_"+Math.round(e.z+i)),o.push(Math.round(e.x)+"_"+Math.round(e.z+i)),o.push(Math.round(e.x+i)+"_"+Math.round(e.z)),o.push(Math.round(e.x-i)+"_"+Math.round(e.z)),o.push(Math.round(e.x)+"_"+Math.round(e.z-i)),o=Array.from(new Set(o));for(var s=[],r=0;r<o.length;r++)a.ins.maps[o[r]]&&(s=s.concat(a.ins.maps[o[r]]));s=Array.from(new Set(s));for(var n=new cc.Rect(e.x-this.width/2+this.xOffset,e.z-this.height/2+this.zOffset,this.width,this.height),l=[],c=0;c<s.length;c++)if(s[c]!=this){var d=s[c].node.getPosition();if(this.isCircle&&s[c].isCircle){var h=this.width/2+s[c].width/2,u=cc.Vec2.distance(cc.v2(e.x,e.z),cc.v2(d.x,d.z));if(u<h){var p=cc.v2(e.x,e.z).subtract(cc.v2(d.x,d.z)).normalize(),f=h-u;l.push({collItem:s[c],dir:p,mdis:f,box:m})}}else{var b=new cc.Rect(d.x-s[c].width/2+s[c].xOffset,d.z-s[c].height/2+s[c].zOffset,s[c].width,s[c].height);if(n.intersects(b)){var m=new cc.Rect;p=cc.v2(t.x,t.z).subtract(cc.v2(d.x,d.z)).normalize();cc.Rect.intersection(m,n,b),l.push({collItem:s[c],dir:p,box:m})}}}return l}},{key:"judgeColl2",value:function(e){for(var t=this.node.getPosition(),i=this.excColl(e,t),o=0,s=0,a=0,r=0;r<i.length;r++){var n=i[r].collItem,l=i[r];if(n.mass>=1)(c=Math.min(l.box.width,l.box.height))>0&&(a++,o+=l.box.width,s+=l.box.height)}var c;if((c=Math.min(o,s))>0){c/=a;var d=cc.v2(this.velocity).normalize();o>s?(e.x-=d.x*c/2,e.z-=d.y*c):(e.x-=d.x*c,e.z-=d.y*c/2)}return e}},{key:"judgeDrop",value:function(){var e=this.node.getPosition(),t=this.collDis/2,i=[];i.push(Math.round(e.x)+"_"+Math.round(e.z)),i.push(Math.round(e.x+t)+"_"+Math.round(e.z+t)),i.push(Math.round(e.x-t)+"_"+Math.round(e.z-t)),i.push(Math.round(e.x+t)+"_"+Math.round(e.z-t)),i.push(Math.round(e.x-t)+"_"+Math.round(e.z+t)),i.push(Math.round(e.x)+"_"+Math.round(e.z+t)),i.push(Math.round(e.x+t)+"_"+Math.round(e.z)),i.push(Math.round(e.x-t)+"_"+Math.round(e.z)),i.push(Math.round(e.x)+"_"+Math.round(e.z-t)),i=Array.from(new Set(i));for(var o=[],s=0;s<i.length;s++)a.ins.maps[i[s]]&&(o=o.concat(a.ins.maps[i[s]]));o=Array.from(new Set(o));for(var r=!0,n=0;n<o.length;n++)if(o[n]!=this&&o[n].mass>this.mass){r=!1;break}return r}},{key:"addAstarMap",value:function(){var e=this.node.getPosition();if(this.isStatic&&e.y<.1){e.x=e.x/1,e.z=e.z/1;var t=Math.round(e.x)+"_"+Math.round(e.z);if(a.ins.roads[t]||(a.ins.roads[t]=[]),a.ins.roads[t].push(this),!this.isCircle){for(var i=Math.floor(this.width/1/2),o=1;o<=i;o++){t=Math.round(e.x+1*o+this.xOffset)+"_"+Math.round(e.z+this.zOffset);a.ins.roads[t]||(a.ins.roads[t]=[]),a.ins.roads[t].push(this);t=Math.round(e.x+1*-o+this.xOffset)+"_"+Math.round(e.z+this.zOffset);a.ins.roads[t]||(a.ins.roads[t]=[]),a.ins.roads[t].push(this)}var s=Math.floor(this.height/this.collDis/2);for(o=1;o<=s;o++){t=Math.round(e.x+this.xOffset)+"_"+Math.round(e.z+1*o+this.zOffset);a.ins.roads[t]||(a.ins.roads[t]=[]),a.ins.roads[t].push(this);t=Math.round(e.x+this.xOffset)+"_"+Math.round(e.z-1*o+this.zOffset);a.ins.roads[t]||(a.ins.roads[t]=[]),a.ins.roads[t].push(this)}}}}},{key:"update",value:function(e){var t=this.node.getPosition(),i=Math.round(t.x)+"_"+Math.round(t.z);if(a.ins.maps[i]||(a.ins.maps[i]=[]),a.ins.maps[i].push(this),!this.isCircle){for(var o=Math.floor(this.width/this.collDis/2),s=1;s<=o;s++){i=Math.round(t.x+this.collDis*s+this.xOffset)+"_"+Math.round(t.z+this.zOffset);a.ins.maps[i]||(a.ins.maps[i]=[]),a.ins.maps[i].push(this);i=Math.round(t.x+this.collDis*-s+this.xOffset)+"_"+Math.round(t.z+this.zOffset);a.ins.maps[i]||(a.ins.maps[i]=[]),a.ins.maps[i].push(this)}var r=Math.floor(this.height/this.collDis/2);for(s=1;s<=r;s++){i=Math.round(t.x+this.xOffset)+"_"+Math.round(t.z+this.collDis*s+this.zOffset);a.ins.maps[i]||(a.ins.maps[i]=[]),a.ins.maps[i].push(this);i=Math.round(t.x+this.xOffset)+"_"+Math.round(t.z-this.collDis*s+this.zOffset);a.ins.maps[i]||(a.ins.maps[i]=[]),a.ins.maps[i].push(this)}}}},{key:"lateUpdate",value:function(e){this.isStatic||("player"==this.node.name?this.judgeColl3(1/30):0==this.velocity.x&&0==this.velocity.y||(this.mass<=1&&this.judgeColl3(1/30),this.velocity.x>0?(this.velocity.x-=this.velocity.x*this.damping,this.velocity.x<this.damping&&(this.velocity.x=0)):(this.velocity.x+=-this.velocity.x*this.damping,this.velocity.x>-this.damping&&(this.velocity.x=0)),this.velocity.y>0?(this.velocity.y-=this.velocity.y*this.damping,this.velocity.y<this.damping&&(this.velocity.y=0)):(this.velocity.y+=-this.velocity.y*this.damping,this.velocity.y>-this.damping&&(this.velocity.y=0))))}},{key:"lateUpdate2",value:function(e){if("player"==this.node.name){this.rigid.enabled=!0,this.collider.enabled=!0;var t=this.node.getPosition();t.y=-.01,this.node.setPosition(t);for(var i=this.getNextPos(e),o=this.excColl(i,t),s=0;s<o.length;s++){var a=o[s].collItem;this.excCallback(a),a.excCallback(this),a.enabled&&(a.isOpenColl=!0,a.upCollDt=.05,a.rigid&&(a.rigid.enabled=!0),a.collider.enabled=!0)}}else this.isOpenColl&&this.upCollDt>0&&(this.upCollDt-=e,this.upCollDt<0&&(this.rigid&&(this.rigid.enabled=!1),this.isOpenColl=!1,this.collider.enabled=!1))}},{key:"enable",value:function(e){this.enabled=e}}]),t}(o),h=babelHelpers.applyDecoratedDescriptor(d.prototype,"width",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),u=babelHelpers.applyDecoratedDescriptor(d.prototype,"height",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),p=babelHelpers.applyDecoratedDescriptor(d.prototype,"isStatic",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),f=babelHelpers.applyDecoratedDescriptor(d.prototype,"mass",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),b=babelHelpers.applyDecoratedDescriptor(d.prototype,"damping",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),m=babelHelpers.applyDecoratedDescriptor(d.prototype,"elastic",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),g=babelHelpers.applyDecoratedDescriptor(d.prototype,"isCircle",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),c=d))||c)),cc._RF.pop()}}})),System.register("project:///assets/script/GColl/QuadTree.js",[],(function(e,t){return{setters:[],execute:function(){cc._RF.push(window.module||{},"8b596LXZp5FdYJ0zSU1mB1K","QuadTree"),cc._RF.pop()}}})),System.register("project:///assets/script/tools/Astar.ts",["cc","../config.ts"],(function(e,t){var i,o,s,a,r,n;function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return c(e,arguments,babelHelpers.getPrototypeOf(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),babelHelpers.setPrototypeOf(o,e)})(e)}function c(e,t,i){return(c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,i){var o=[null];o.push.apply(o,t);var s=new(Function.bind.apply(e,o));return i&&babelHelpers.setPrototypeOf(s,i.prototype),s}).apply(null,arguments)}return e({_dec:void 0,_class:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator},function(e){o=e.config}],execute:function(){cc._RF.push(window.module||{},"7b68ehfp1dBqJ5kWSotX5HN","Astar"),n=i.ccclass,i.property,e("Astar",(s=n("Astar"),s((r=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)))).row=31,i.col=61,i.openList=[],i.closeList=[],i.pathList=[],i.openMap={},i.closeMap={},i.num=0,i.initEndNum=0,i.initStartNum=0,i.currCollPos=null,i.startDir=[1,1,1,1],i.isFind=!1,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"findPath",value:function(e,t,i){this.row=o.astarmap.length,this.col=o.astarmap[0].length,e=o.converToNodePos(e),t=o.converToNodePos(t),this.startPoint=e,this.endPoint=t,this.currCollPos=i,this.startPoint.g=0,this.startPoint.h=0,this.startPoint.f=0,this.initStartPoint(),this.initEndPoint(),this.addCloseList(this.startPoint);for(var s=(new Date).getTime();this.findNext()&&this.num<2e3;)this.num++;if(this.isFind){var a=this.closeList.pop();for(a=o.converToWorldPos(a),this.pathList.push(a);a.parent;)o.astarmap[a.parent.y][a.parent.x]||cc.log("---x---",a.parent,e,this.startPoint),a.parent=o.converToWorldPos(a.parent),this.pathList.unshift(a.parent),a=a.parent}t=o.converToWorldPos(t),this.pathList.push(t),this.num>990&&cc.log("--x----num="+this.num,(new Date).getTime()-s)}},{key:"initStartPoint",value:function(){var e=Math.round(this.startPoint.x),t=Math.round(this.startPoint.y),i=this.initStartNum++;if(!o.astarmap[t][e]){if(e-i>0&&o.astarmap[t][e-i]&&this.startDir[0])return void(this.startPoint.x-=i);if(this.startDir[0]=0,e+i<this.col&&o.astarmap[t][e+i]&&this.startDir[1])return void(this.startPoint.x+=i);if(this.startDir[1]=0,t-i>0&&o.astarmap[t-i][e]&&this.startDir[2])return void(this.startPoint.y-=i);if(this.startDir[2]=0,t+i<this.row&&o.astarmap[t+i][e]&&this.startDir[3])return void(this.startPoint.y+=i);this.startDir[3]=0}this.initStartNum++,this.initStartNum<8&&this.initStartPoint()}},{key:"initEndPoint",value:function(){var e=this.endPoint.x,t=this.endPoint.y;if(!o.astarmap[t][e]){var i=this.initEndNum+1;e-i>0&&o.astarmap[t][e-i]?this.endPoint.x-=i:e+i<this.col&&o.astarmap[t][e+i]?this.endPoint.x+=i:t-i>0&&o.astarmap[t-i][e]?this.endPoint.y-=i:t+i<this.row&&o.astarmap[t+i][e]?this.endPoint.y+=i:(this.initEndNum++,this.initEndNum<8&&this.initEndPoint())}}},{key:"findNext",value:function(){var e={x:(c=this.closeList[this.closeList.length-1]).x,y:c.y+1};if(e.x==this.endPoint.x&&e.y==this.endPoint.y)return this.isFind=!0,!1;e.y<this.row&&o.astarmap[e.y][e.x]&&this.addOpenList(e,c);var t={x:c.x,y:c.y-1};if(t.x==this.endPoint.x&&t.y==this.endPoint.y)return this.isFind=!0,!1;t.y>0&&o.astarmap[t.y][t.x]&&this.addOpenList(t,c);var i={x:c.x-1,y:c.y};if(i.x==this.endPoint.x&&i.y==this.endPoint.y)return this.isFind=!0,!1;i.x>0&&o.astarmap[i.y][i.x]&&this.addOpenList(i,c);var s={x:c.x+1,y:c.y};if(s.x==this.endPoint.x&&s.y==this.endPoint.y)return this.isFind=!0,!1;s.x<this.col&&o.astarmap[s.y][s.x]&&this.addOpenList(s,c);var a={x:c.x+1,y:c.y+1};if(a.x==this.endPoint.x&&a.y==this.endPoint.y)return this.isFind=!0,!1;a.x<this.col&&a.y<this.row&&o.astarmap[a.y][a.x]&&this.addOpenList(a,c);var r={x:c.x+1,y:c.y-1};if(r.x==this.endPoint.x&&r.y==this.endPoint.y)return this.isFind=!0,!1;r.x<this.col&&r.y>0&&o.astarmap[r.y][r.x]&&this.addOpenList(r,c);var n={x:c.x-1,y:c.y+1};if(n.x==this.endPoint.x&&n.y==this.endPoint.y)return this.isFind=!0,!1;n.x>0&&n.y<this.row&&o.astarmap[n.y][n.x]&&this.addOpenList(n,c);var l={x:c.x-1,y:c.y-1};if(l.x==this.endPoint.x&&l.y==this.endPoint.y)return this.isFind=!0,!1;if(l.x>0&&l.y>0&&o.astarmap[l.y][l.x]&&this.addOpenList(l,c),this.openList.length>0){var c=this.openList[0];this.closeMap[c.x+"_"+c.y]||(this.addCloseList(c),this.openList.shift(),this.sortOpenList())}return this.openList.length>0}},{key:"sortOpenList",value:function(){if(this.openList.length>0){for(var e=this.openList[0],t=0,i=1;i<this.openList.length;i++)this.openList[i].f<e.f&&(t=i,e=this.openList[i]);if(0!=t){var o=this.openList[0],s=this.openList[t];this.openList[t]=o,this.openList[0]=s}}}},{key:"addOpenList",value:function(e,t){this.openMap[e.x+"_"+e.y]||this.closeMap[e.x+"_"+e.y]||(this.openMap[e.x+"_"+e.y]=1,e.x-t.x!=0&&e.y-t.y!=0?e.g=14*this.num:e.g=10*this.num,e.h=10*Math.abs(e.x-this.endPoint.x)+10*Math.abs(e.y-this.endPoint.y),e.f=e.g+e.h,e.parent=t,this.openList.length>0?e.f>this.openList[0].f?this.openList.push(e):this.openList.unshift(e):this.openList.push(e))}},{key:"addCloseList",value:function(e){this.closeMap[e.x+"_"+e.y]=1,this.closeList.push(e)}}]),t}(l(Object)),a=r))||a)),cc._RF.pop()}}})),System.register("project:///assets/script/tools/AstarOut.ts",["cc"],(function(e,t){var i,o,s,a,r;return e({_dec:void 0,_class:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component}],execute:function(){cc._RF.push(window.module||{},"8b15bHSBRZDmY7sCZX2LZfu","AstarOut"),r=i.ccclass,i.property,e("AstarOut",(s=r("AstarOut"),s(a=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)))).maps=[],i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.loadNodeRow(this.node),cc.sys.localStorage.setItem("AstarOut",JSON.stringify(this.maps))}},{key:"loadNodeRow",value:function(e){for(var t=e.children,i=0;i<t.length;i++)this.maps.push([]),this.loadNodeCol(t[i])}},{key:"loadNodeCol",value:function(e){for(var t=e.children,i=0;i<t.length;i++)this.maps[this.maps.length-1].push(t[i].active?0:1)}}]),t}(o))||a)),cc._RF.pop()}}})),System.register("project:///assets/script/tools/NodeOut.ts",["cc"],(function(e,t){var i,o,s,a,r;return e({_dec:void 0,_class:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component}],execute:function(){cc._RF.push(window.module||{},"4f1faFu3NBDqYMNpZ6a18tW","NodeOut"),r=i.ccclass,i.property,e("NodeOut",(s=r("NodeOut"),s(a=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)))).conf=[],i.item=[],i.zScore=0,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.conf=[{ID:"1",Prefab:"Shelves_01",Name:"小货架",Require:"6",Score:"25",Capacity:"1",CapacityAdd:"10"},{ID:"2",Prefab:"Shelves_02",Name:"中货架",Require:"8",Score:"40",Capacity:"1",CapacityAdd:"15"},{ID:"3",Prefab:"Shelves_03",Name:"大货架",Require:"9",Score:"80",Capacity:"1",CapacityAdd:"25"},{ID:"4",Prefab:"Res101",Name:"纸袋子",Require:"1",Score:"1",Capacity:"1",CapacityAdd:"0"},{ID:"5",Prefab:"Res102",Name:"面包",Require:"1",Score:"2",Capacity:"1",CapacityAdd:"0"},{ID:"6",Prefab:"Res201",Name:"手提袋",Require:"3",Score:"4",Capacity:"1.5",CapacityAdd:"0"},{ID:"7",Prefab:"Res202",Name:"平底锅",Require:"3",Score:"6",Capacity:"1.5",CapacityAdd:"0"},{ID:"8",Prefab:"Res301",Name:"锅",Require:"5",Score:"10",Capacity:"2.5",CapacityAdd:"0"},{ID:"9",Prefab:"Res302",Name:"速食套餐",Require:"5",Score:"10",Capacity:"2.5",CapacityAdd:"0"},{ID:"10",Prefab:"Res401",Name:"床",Require:"5",Score:"10",Capacity:"2.5",CapacityAdd:"0"},{ID:"11",Prefab:"Res402",Name:"椅子",Require:"5",Score:"10",Capacity:"2.5",CapacityAdd:"0"},{ID:"12",Prefab:"Res403",Name:"显示器",Require:"5",Score:"10",Capacity:"2.5",CapacityAdd:"0"},{ID:"13",Prefab:"Res404",Name:"桌子",Require:"5",Score:"10",Capacity:"2.5",CapacityAdd:"0"}],this.zScore=0,this.loadNode(this.node),cc.sys.localStorage.setItem("item",JSON.stringify(this.item)),cc.log("总分="+this.zScore)}},{key:"loadNode",value:function(e){for(var t=e.children,i=0;i<t.length;i++)this.loadNode(t[i]);var o=this.hasNode(e.name);if(o.id>0){var s=e.getWorldPosition(),a=e.getWorldRotation();(s.x+"").length>6&&(s.x=s.x.toFixed(1)),(s.y+"").length>6&&(s.y=s.y.toFixed(1)),(s.z+"").length>6&&(s.z=s.z.toFixed(1)),(a.x+"").length>6&&(a.x=a.x.toFixed(1)),(a.y+"").length>6&&(a.y=a.y.toFixed(1)),(a.z+"").length>6&&(a.z=a.z.toFixed(1)),(a.w+"").length>6&&(a.w=a.w.toFixed(1));var r=[];for(i=0;i<t.length;i++){var n=t[i];if("coll"==n.name){var l=n.getWorldPosition();l.x=l.x.toFixed(1),l.z=l.z.toFixed(1),r.push({x:l.x,z:l.z})}}r.length>0?this.item.push({id:o.id,x:s.x,y:s.y,z:s.z,rx:a.x,ry:a.y,rz:a.z,rw:a.w,c:r}):this.item.push({id:o.id,x:s.x,y:s.y,z:s.z,rx:a.x,ry:a.y,rz:a.z,rw:a.w}),this.zScore+=Number(o.score)}}},{key:"hasNode",value:function(e){for(var t=0;t<this.conf.length;t++)if(this.conf[t].Prefab==e)return{id:t+1,score:this.conf[t].Score};return{id:0}}}]),t}(o))||a)),cc._RF.pop()}}})),System.register("project:///assets/script/tools/NodeOut2.ts",["cc"],(function(e,t){var i,o,s,a,r;return e({_dec:void 0,_class:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component}],execute:function(){cc._RF.push(window.module||{},"741e2DdQhZBiLM2K+3WG9yF","NodeOut2"),r=i.ccclass,i.property,e("NodeOut2",(s=r("NodeOut2"),s(a=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)))).maps=[],i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.loadNode(this.node),cc.sys.localStorage.setItem("item2",JSON.stringify(this.maps))}},{key:"loadNode",value:function(e){for(var t=e.children,i=0;i<t.length;i++)this.loadNode(t[i]);var o=e.name.split("_");if(2==o.length){var s=Number(o[0])-1,a=Number(o[1])-1;this.maps[s]||(this.maps[s]=[]);var r=e.getWorldPosition();r.x=Math.floor(r.x),r.y=Math.floor(r.z),this.maps[s][a]={x:r.x,y:r.y}}}}]),t}(o))||a)),cc._RF.pop()}}})),System.register("project:///assets/script/ui/countdown.ts",["cc","../ani.ts"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b,m,g,v,y,C,x,S,w,k,P;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_dec4:void 0,_dec5:void 0,_dec6:void 0,_dec7:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_descriptor3:void 0,_descriptor4:void 0,_descriptor5:void 0,_descriptor6:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Node,a=e.LabelComponent,r=e.SpriteComponent,n=e.BlockInputEventsComponent},function(e){l=e.ani}],execute:function(){cc._RF.push(window.module||{},"b9a883t5N9KiJqlDL9MymUO","countdown"),k=i.ccclass,P=i.property,e("countdown",(c=k("countdown"),d=P(a),h=P(a),u=P(s),p=P(s),f=P(s),b=P(s),c((g=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"timeLabel",v,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"timeLabel2",y,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"startNode",C,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"endNode",x,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"sp2",S,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"endsp",w,babelHelpers.assertThisInitialized(i)),i.gameControl=null,i.mainControl=null,i.type=null,i.anisc=null,i.anisc2=null,i.anisc3=null,i.anisc4=null,i.num=3,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){1==this.type?(this.startNode.active=!0,this.endNode.active=!1,this.anisc=this.timeLabel.node.addComponent(l),this.anisc2=this.sp2.addComponent(l),this.schedule(this.updateUI1.bind(this),1,3,1),this.timeLabel.string=""):(this.startNode.active=!1,this.endNode.active=!0,this.node.removeComponent(r),this.node.removeComponent(n),this.num=11,this.anisc3=this.timeLabel2.node.addComponent(l),this.anisc4=this.endsp.addComponent(l),this.schedule(this.updateUI2.bind(this),1,10,0),this.timeLabel2.string="")}},{key:"updateUI1",value:function(){var e=this;this.timeLabel.string=this.num+"",0==this.num?(this.timeLabel.string="",this.sp2.active=!0,this.anisc2.scaleTo(.3,cc.v3(1.3,1.3,1.3),(function(){e.sp2.setScale(cc.v3(1,1,1)),e.hide()}))):this.anisc.scaleTo(.3,cc.v3(1.3,1.3,1.3),(function(){e.timeLabel.node.setScale(cc.v3(1,1,1)),e.num--}))}},{key:"updateUI2",value:function(){var e=this;11==this.num?(this.timeLabel2.string="",this.endsp.active=!0,this.anisc4.scaleTo(.3,cc.v3(1.3,1.3,1.3),(function(){e.endsp.setScale(cc.v3(1,1,1)),e.endsp.active=!1})),e.num--):(this.timeLabel2.string=this.num+"",this.anisc3.scaleTo(.3,cc.v3(1.3,1.3,1.3),(function(){e.timeLabel2.node.setScale(cc.v3(1,1,1)),e.num--,e.num<=0&&e.hide()})))}},{key:"show",value:function(e){this.type=e,this.gameControl=cc.find("gameNode").getComponent("gameControl"),this.mainControl=cc.find("gameNode").getComponent("mainControl")}},{key:"hide",value:function(){1==this.type&&this.gameControl.startCountDown(),this.node.parent.destroy()}},{key:"click",value:function(e,t){"close"==t&&this.hide()}}]),t}(o),v=babelHelpers.applyDecoratedDescriptor(g.prototype,"timeLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=babelHelpers.applyDecoratedDescriptor(g.prototype,"timeLabel2",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=babelHelpers.applyDecoratedDescriptor(g.prototype,"startNode",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=babelHelpers.applyDecoratedDescriptor(g.prototype,"endNode",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=babelHelpers.applyDecoratedDescriptor(g.prototype,"sp2",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=babelHelpers.applyDecoratedDescriptor(g.prototype,"endsp",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=g))||m)),cc._RF.pop()}}})),System.register("project:///assets/script/ui/jiesuan2.ts",["cc","../storage.ts"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b,m,g,v,y;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_dec4:void 0,_dec5:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_descriptor3:void 0,_descriptor4:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Node,a=e.LabelComponent},function(e){r=e.storage}],execute:function(){cc._RF.push(window.module||{},"9cd21CJalFBfIXbp1EtwJqS","jiesuan2"),v=i.ccclass,y=i.property,e("jiesuan2",(n=v("jiesuan2"),l=y(a),c=y(s),d=y(s),h=y(s),n((p=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"coinLabel",f,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"btnHome",b,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"btnLingqu",m,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"titleNode",g,babelHelpers.assertThisInitialized(i)),i.gameControl=null,i.mainControl=null,i.type=null,i.useShare=!1,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.initUI(),this.updateAd()}},{key:"initUI",value:function(){var e=this.gameControl.playerSc.currScore;this.coinLabel.string=r.castNum(e),e>r.getStorage(r.maxscore2)&&r.setStorage(r.maxscore2,e);var t=1;e>=800&&e<1500?t=2:e>=1500&&e<2400?t=3:e>=2400&&e<3200?t=4:e>=3200&&(t=5),cc.res.setSpriteFrame("images/jiesuan/ImgResultTitle"+t+"/spriteFrame",this.titleNode)}},{key:"updateAd",value:function(){if(this.useShare=!1,cc.GAME.share){var e=parseInt(cc.GAME.jiesuanAd);cc.GAME.hasVideo||(e=100),100*Math.random()<e?(this.useShare=!0,this.btnLingqu.getChildByName("share").active=!0,this.btnLingqu.getChildByName("video").active=!1):(this.btnLingqu.getChildByName("share").active=!1,this.btnLingqu.getChildByName("video").active=!0)}else this.btnLingqu.getChildByName("share").active=!1,this.btnLingqu.getChildByName("video").active=!0}},{key:"liangqu",value:function(e){var t=this.gameControl.playerSc.currScore;if(e)t*=2,this.btnLingqu.active=!1,r.setStorage(r.coin,r.getStorage(r.coin)+t),r.uploadStorage(r.coin),cc.res.showToast("金币+"+t);else{this.btnLingqu.active&&(this.btnHome.active=!1,this.btnLingqu.active=!1,r.setStorage(r.coin,r.getStorage(r.coin)+t),r.uploadStorage(r.coin),cc.res.showToast("金币+"+t));var i=this;this.scheduleOnce((function(){i.hide(),cc.director.loadScene("main")}),.2)}}},{key:"show",value:function(e){this.type=e,this.gameControl=cc.find("gameNode").getComponent("gameControl"),this.mainControl=cc.find("gameNode").getComponent("mainControl"),cc.sdk.showBanner()}},{key:"hide",value:function(){this.node.parent.destroy(),cc.sdk.hideBanner()}},{key:"click",value:function(e,t){if("close"==t)this.hide();else if("home"==t)this.liangqu(!1);else if("liangqu"==t){var i=this;this.useShare?cc.sdk.share((function(e){e&&i.liangqu(!0)})):cc.sdk.showVedio((function(e){e&&i.liangqu(!0)}))}cc.audio.playSound("audio/button")}}]),t}(o),f=babelHelpers.applyDecoratedDescriptor(p.prototype,"coinLabel",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=babelHelpers.applyDecoratedDescriptor(p.prototype,"btnHome",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=babelHelpers.applyDecoratedDescriptor(p.prototype,"btnLingqu",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=babelHelpers.applyDecoratedDescriptor(p.prototype,"titleNode",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=p))||u)),cc._RF.pop()}}})),System.register("project:///assets/script/ui/jiesuan.ts",["cc","../storage.ts"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b,m,g,v,y,C,x,S,w,k,P,_;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_dec4:void 0,_dec5:void 0,_dec6:void 0,_dec7:void 0,_dec8:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_descriptor3:void 0,_descriptor4:void 0,_descriptor5:void 0,_descriptor6:void 0,_descriptor7:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Node,a=e.LabelComponent,r=e.SpriteComponent},function(e){n=e.storage}],execute:function(){cc._RF.push(window.module||{},"e7d00umGZJA/478f1/0yroy","jiesuan"),P=i.ccclass,_=i.property,e("jiesuan",(l=P("jiesuan"),c=_(s),d=_(s),h=_(a),u=_(a),p=_(s),f=_(s),b=_(a),l((g=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"item",v,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"itemLay",y,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"coinLabel",C,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"rankLabel",x,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"btnHome",S,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"btnLingqu",w,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"starLabel",k,babelHelpers.assertThisInitialized(i)),i.gameControl=null,i.mainControl=null,i.type=null,i.useShare=!1,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.initUI(),this.updateAd()}},{key:"initUI",value:function(){for(var e=0,t=0;t<this.gameControl.players.length;t++){var i=this.gameControl.players[t],o=cc.instantiate(this.item);o.active=!0;var s=cc.find("icon",o),l=cc.find("rank",o).getComponent(a),c=cc.find("nick",o).getComponent(a),d=cc.find("score",o).getComponent(a);l.string=t+1,c.string=cc.storage.getLabelStr(i.nick,14),d.string=i.currScore,0==t?(cc.res.setSpriteFrame("images/game/ImgGameFirst/spriteFrame",s),c.color=new cc.Color("#ff9c00"),d.color=new cc.Color("#ff9c00")):1==t?(cc.res.setSpriteFrame("images/game/ImgGameSecond/spriteFrame",s),c.color=new cc.Color("#96b5c8"),d.color=new cc.Color("#96b5c8")):2==t?(cc.res.setSpriteFrame("images/game/ImgGameThird/spriteFrame",s),c.color=new cc.Color("#d07741"),d.color=new cc.Color("#d07741")):(s.getComponent(r).color=new cc.Color("#000000"),s.opacity=100,i==this.gameControl.playerSc?(c.color=new cc.Color("#ffe25b"),d.color=new cc.Color("#ffe25b")):(c.color=new cc.Color("#ffffff"),d.color=new cc.Color("#ffffff"))),this.itemLay.addChild(o),i==this.gameControl.playerSc&&(e=t+1)}this.rankLabel.string=e,this.coinLabel.string=n.castNum(this.gameControl.playerSc.currScore);var h=n.getStorage(n.maxscore);this.gameControl.playerSc.currScore>h&&n.setStorage(n.maxscore,this.gameControl.playerSc.currScore);var u=Number(cc.res.loads.conf_starrank[e-1].experience);this.starLabel.string=u;var p=n.getStorage(n.starlv),f=n.getStorage(n.starexp);f+=u;var b=null;if(p<cc.res.loads.conf_starlv.length&&(b=cc.res.loads.conf_starlv[p-1]),b&&f>=Number(b.experience)&&(f-=Number(b.experience),n.setStorage(n.starlv,p+1),n.uploadStorage(n.starlv),this.scheduleOnce((function(){cc.res.openUI("starup")}),1)),n.setStorage(n.starexp,f),n.uploadStorage(n.starexp),1==e){var m=n.getStorage(n.modewinnum);n.setStorage(n.modewinnum,m+1),n.uploadStorage(n.modewinnum)}}},{key:"updateAd",value:function(){if(this.useShare=!1,cc.GAME.share){var e=parseInt(cc.GAME.jiesuanAd);cc.GAME.hasVideo||(e=100),100*Math.random()<e?(this.useShare=!0,this.btnLingqu.getChildByName("share").active=!0,this.btnLingqu.getChildByName("video").active=!1):(this.btnLingqu.getChildByName("share").active=!1,this.btnLingqu.getChildByName("video").active=!0)}else this.btnLingqu.getChildByName("share").active=!1,this.btnLingqu.getChildByName("video").active=!0}},{key:"liangqu",value:function(e){var t=this.gameControl.playerSc.currScore;if(e)t*=2,this.btnLingqu.active=!1,n.setStorage(n.coin,n.getStorage(n.coin)+t),n.uploadStorage(n.coin),cc.res.showToast("金币+"+t);else{this.btnLingqu.active&&(this.btnHome.active=!1,this.btnLingqu.active=!1,n.setStorage(n.coin,n.getStorage(n.coin)+t),n.uploadStorage(n.coin),cc.res.showToast("金币+"+t));var i=this;this.scheduleOnce((function(){i.hide(),cc.director.loadScene("main")}),.2)}}},{key:"show",value:function(e){this.type=e,this.gameControl=cc.find("gameNode").getComponent("gameControl"),this.mainControl=cc.find("gameNode").getComponent("mainControl"),cc.sdk.showBanner()}},{key:"hide",value:function(){this.node.parent.destroy(),cc.sdk.hideBanner()}},{key:"click",value:function(e,t){if("close"==t)this.hide();else if("home"==t)this.liangqu(!1);else if("liangqu"==t){var i=this;this.useShare?cc.sdk.share((function(e){e&&i.liangqu(!0)})):cc.sdk.showVedio((function(e){e&&i.liangqu(!0)}))}cc.audio.playSound("audio/button")}}]),t}(o),v=babelHelpers.applyDecoratedDescriptor(g.prototype,"item",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=babelHelpers.applyDecoratedDescriptor(g.prototype,"itemLay",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=babelHelpers.applyDecoratedDescriptor(g.prototype,"coinLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=babelHelpers.applyDecoratedDescriptor(g.prototype,"rankLabel",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=babelHelpers.applyDecoratedDescriptor(g.prototype,"btnHome",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=babelHelpers.applyDecoratedDescriptor(g.prototype,"btnLingqu",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=babelHelpers.applyDecoratedDescriptor(g.prototype,"starLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=g))||m)),cc._RF.pop()}}})),System.register("project:///assets/script/ui/lixian.ts",["cc","../storage.ts"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Node,a=e.LabelComponent},function(e){r=e.storage}],execute:function(){cc._RF.push(window.module||{},"d6a551kGfVL35C7WPKqeohj","lixian"),f=i.ccclass,b=i.property,e("lixian",(n=f("lixian"),l=b(a),c=b(s),n((h=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"coinLabel",u,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"btnLingqu2",p,babelHelpers.assertThisInitialized(i)),i.gameControl=null,i.mainControl=null,i.type=null,i.award=0,i.useShare=!1,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.initUI(),this.updateAd()}},{key:"initUI",value:function(){var e=(new Date).getTime(),t=r.getStorage(r.logintime);if(0==t)return r.setStorage(r.logintime,e),r.uploadStorage(r.logintime),void this.hide();var i=(e-t)/1e3/60;if(i>=1){i>120&&(i=120);var o=r.getStorage(r.lixianlv),s=cc.res.loads.conf_playerlv[o];this.award=Math.floor(Number(s.offline)*i),this.coinLabel.string=r.castNum(this.award)}r.setStorage(r.logintime,e),r.uploadStorage(r.logintime),i<1&&this.hide()}},{key:"updateAd",value:function(){if(this.useShare=!1,cc.GAME.share){var e=parseInt(cc.GAME.lixianAd);cc.GAME.hasVideo||(e=100),100*Math.random()<e?(this.useShare=!0,this.btnLingqu2.getChildByName("share").active=!0,this.btnLingqu2.getChildByName("video").active=!1):(this.btnLingqu2.getChildByName("share").active=!1,this.btnLingqu2.getChildByName("video").active=!0)}else this.btnLingqu2.getChildByName("share").active=!1,this.btnLingqu2.getChildByName("video").active=!0}},{key:"liangqu",value:function(e){e&&(this.award*=2),r.setStorage(r.coin,r.getStorage(r.coin)+this.award),r.uploadStorage(r.coin),cc.res.showToast("金币+"+this.award),this.hide()}},{key:"show",value:function(e){this.type=e,this.gameControl=cc.find("gameNode").getComponent("gameControl"),this.mainControl=cc.find("gameNode").getComponent("mainControl"),cc.sdk.showBanner()}},{key:"hide",value:function(){this.node.parent.destroy(),cc.sdk.hideBanner()}},{key:"click",value:function(e,t){if("close"==t)this.hide();else if("liangqu"==t)this.liangqu(!1);else if("liangqu2"==t){var i=this;this.useShare?cc.sdk.share((function(e){e&&i.liangqu(!0)})):cc.sdk.showVedio((function(e){e&&i.liangqu(!0)}))}cc.audio.playSound("audio/button")}}]),t}(o),u=babelHelpers.applyDecoratedDescriptor(h.prototype,"coinLabel",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=babelHelpers.applyDecoratedDescriptor(h.prototype,"btnLingqu2",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=h))||d)),cc._RF.pop()}}})),System.register("project:///assets/script/ui/modesel.ts",["cc"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b,m,g,v,y;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_dec4:void 0,_dec5:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_descriptor3:void 0,_descriptor4:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Node,a=e.ButtonComponent,r=e.SpriteComponent}],execute:function(){cc._RF.push(window.module||{},"5e8735Hq5lAFYzMzKx7edLr","modesel"),v=i.ccclass,y=i.property,e("modesel",(n=v("modesel"),l=y(a),c=y(a),d=y(s),h=y(s),n((p=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"mode1",f,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"mode2",b,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"sel1",m,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"sel2",g,babelHelpers.assertThisInitialized(i)),i.mainControl=null,i.type=null,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.updateMode()}},{key:"updateMode",value:function(){1==cc.storage.getStorage(cc.storage.mode)?(this.mode1.interactable=!1,this.sel1.active=!0,this.mode2.interactable=!0,this.sel2.active=!1,this.mode2.node.getComponent(r).color=cc.color(255,255,255)):(this.mode1.interactable=!0,this.sel1.active=!1,this.mode1.node.getComponent(r).color=cc.color(255,255,255),this.mode2.interactable=!1,this.sel2.active=!0),this.mainControl.updateMode()}},{key:"show",value:function(e){this.type=e,this.mainControl=cc.find("gameNode").getComponent("mainControl"),cc.sdk.showBanner()}},{key:"hide",value:function(){this.node.parent.destroy(),cc.sdk.hideBanner()}},{key:"click",value:function(e,t){"close"==t?this.hide():"mode1"==t?(cc.storage.setStorage(cc.storage.mode,1),this.updateMode()):"mode2"==t&&(cc.storage.setStorage(cc.storage.mode,2),this.updateMode()),cc.log(t),cc.audio.playSound("audio/button")}}]),t}(o),f=babelHelpers.applyDecoratedDescriptor(p.prototype,"mode1",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=babelHelpers.applyDecoratedDescriptor(p.prototype,"mode2",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=babelHelpers.applyDecoratedDescriptor(p.prototype,"sel1",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=babelHelpers.applyDecoratedDescriptor(p.prototype,"sel2",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=p))||u)),cc._RF.pop()}}})),System.register("project:///assets/script/ui/skin.ts",["cc","../storage.ts"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b,m,g,v,y,C,x,S,w,k,P,_,N,z,H,D,M,I;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_dec4:void 0,_dec5:void 0,_dec6:void 0,_dec7:void 0,_dec8:void 0,_dec9:void 0,_dec10:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_descriptor3:void 0,_descriptor4:void 0,_descriptor5:void 0,_descriptor6:void 0,_descriptor7:void 0,_descriptor8:void 0,_descriptor9:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Node,a=e.ButtonComponent,r=e.LabelComponent,n=e.ProgressBarComponent,l=e.ScrollViewComponent},function(e){c=e.storage}],execute:function(){cc._RF.push(window.module||{},"65dddMrEBJFJJot7vB6zic4","skin"),M=i.ccclass,I=i.property,e("skin",(d=M("skin"),h=I(a),u=I(a),p=I(r),f=I(r),b=I(n),m=I(s),g=I(s),v=I(s),y=I(l),d((x=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"btnSel",S,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"btnLock",w,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"titleLabel",k,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"protitleLabel",P,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"pro",_,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"item",N,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"item2",z,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"listNode",H,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"scroll",D,babelHelpers.assertThisInitialized(i)),i.mainControl=null,i.type=null,i.isNeedScoll=!1,i.skinid=0,i.hasskin=[],i.currScollIndex=1,i.useShare=!1,i.itemConfig=[{id:1,type:1,desc:"明天再玩"},{id:2,type:2,desc:"连续登陆7天"},{id:3,type:1,desc:"经典模式争取第一"},{id:4,type:1,desc:"经典模式得分2000"},{id:5,type:1,desc:"经典模式得分2500"},{id:6,type:2,desc:"3次经典模式获得最高分奖杯"},{id:7,type:1,desc:"达到白金级"},{id:8,type:1,desc:"达到钻石级"},{id:9,type:1,desc:"达到大师级"},{id:10,type:1,desc:"达到星耀级"}],i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.skinid=c.getStorage(c.skinid),this.hasskin=c.getStorage(c.hasskin),this.hasskin||(this.hasskin=[]);for(var e=0;e<this.itemConfig.length;e++){var t=cc.instantiate(this.item);t.active=!0;var i=cc.find("sel",t),o=cc.find("lock",t),s=cc.find("mode",t);cc.res.setSpriteFrame("images/skin/ImgSkin"+(e+1)+"/spriteFrame",s),o.active=!0,-1!=c.indexOf(this.hasskin,e+1)&&(o.active=!1),e+1==this.skinid?i.active=!0:i.active=!1,this.listNode.addChild(t)}var a=cc.instantiate(this.item2);this.listNode.addChild(a);a=cc.instantiate(this.item2);this.listNode.addChild(a);var r=this;this.scroll.node.on("touch-up",(function(){r.isNeedScoll=!0})),this.scroll.node.on("scroll-ended",(function(){r.isNeedScoll&&(r.isNeedScoll=!1,r.scheduleOnce((function(){var e=r.scroll.getScrollOffset().x,t=250*Math.round(-e/250);r.scroll.scrollToOffset(cc.v3(t,0,0),0,!0),r.updateSel(Math.floor(t/250))}),0))})),r.scheduleOnce((function(){var e=250*r.skinid;e>1&&(e-=250),r.scroll.scrollToOffset(cc.v3(e,0,0),0,!0),r.updateSel(Math.floor(e/250))}),0)}},{key:"updateSel",value:function(e){e<0&&(e=0),e>=this.itemConfig.length&&(e=this.itemConfig.length-1),this.titleLabel.string=this.itemConfig[e].desc,this.currScollIndex=e+1,1==this.itemConfig[e].type?this.pro.node.active=!1:this.pro.node.active=!0;var t=this.itemConfig[e].id;if(1==t)this.protitleLabel.string="";else if(2==t){var i=c.getStorage(c.loginday);this.protitleLabel.string=i+"/7",this.pro.progress=i/7}else if(3==t)this.protitleLabel.string="";else if(4==t){var o=c.getStorage(c.maxscore);this.protitleLabel.string=o+"/2000",this.pro.progress=o/2e3}else if(5==t){o=c.getStorage(c.maxscore);this.protitleLabel.string=o+"/2500",this.pro.progress=o/2500}else if(6==t){var s=c.getStorage(c.modewinnum);this.protitleLabel.string=s+"/3",this.pro.progress=s/3}else if(7==t||8==t||9==t||10==t){var a=c.getStorage(c.starlv);this.protitleLabel.string="当前："+cc.res.loads.conf_starlv[a-1].name}-1!=c.indexOf(this.hasskin,this.currScollIndex)?(this.btnSel.node.active=!0,this.btnLock.node.active=!1,this.protitleLabel.string="已获得"):(this.btnSel.node.active=!1,this.btnLock.node.active=!0,this.updateAd()),cc.log(e)}},{key:"toSel",value:function(){if(this.currScollIndex!=this.skinid){if(this.skinid>0){var e=this.listNode.children[this.skinid-1];cc.find("sel",e).active=!1}e=this.listNode.children[this.currScollIndex-1];cc.find("sel",e).active=!0,this.skinid=this.currScollIndex,c.setStorage(c.skinid,this.skinid),this.mainControl.updateSkin()}}},{key:"toLock",value:function(){this.hasskin.push(this.currScollIndex),c.setStorage(c.hasskin,this.hasskin),c.uploadStorage(c.hasskin);var e=this.listNode.children[this.currScollIndex-1];cc.find("lock",e).active=!1,this.updateSel(this.currScollIndex-1)}},{key:"updateAd",value:function(){if(this.useShare=!1,cc.GAME.share){var e=parseInt(cc.GAME.skinAd);cc.GAME.hasVideo||(e=100),100*Math.random()<e?(this.useShare=!0,this.btnLock.node.getChildByName("share").active=!0,this.btnLock.node.getChildByName("video").active=!1):(this.btnLock.node.getChildByName("share").active=!1,this.btnLock.node.getChildByName("video").active=!0)}else this.btnLock.node.getChildByName("share").active=!1,this.btnLock.node.getChildByName("video").active=!0}},{key:"show",value:function(e){this.type=e,this.mainControl=cc.find("gameNode").getComponent("mainControl"),cc.sdk.showBanner()}},{key:"hide",value:function(){this.node.parent.destroy(),cc.sdk.hideBanner()}},{key:"click",value:function(e,t){if("close"==t)this.hide();else if("sel"==t)this.toSel();else if("lock"==t){var i=this;this.useShare?cc.sdk.share((function(e){e&&i.toLock()})):cc.sdk.showVedio((function(e){e&&i.toLock()}))}cc.log(t),cc.audio.playSound("audio/button")}}]),t}(o),S=babelHelpers.applyDecoratedDescriptor(x.prototype,"btnSel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=babelHelpers.applyDecoratedDescriptor(x.prototype,"btnLock",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=babelHelpers.applyDecoratedDescriptor(x.prototype,"titleLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=babelHelpers.applyDecoratedDescriptor(x.prototype,"protitleLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=babelHelpers.applyDecoratedDescriptor(x.prototype,"pro",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=babelHelpers.applyDecoratedDescriptor(x.prototype,"item",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=babelHelpers.applyDecoratedDescriptor(x.prototype,"item2",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=babelHelpers.applyDecoratedDescriptor(x.prototype,"listNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=babelHelpers.applyDecoratedDescriptor(x.prototype,"scroll",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=x))||C)),cc._RF.pop()}}})),System.register("project:///assets/script/ui/starup.ts",["cc","../storage.ts"],(function(e,t){var i,o,s,a,r,n,l,c,d,h,u,p,f,b;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,o=e.Component,s=e.Node,a=e.LabelComponent},function(e){r=e.storage}],execute:function(){cc._RF.push(window.module||{},"ce03e+IQoRD7JamQTx1g1EC","starup"),f=i.ccclass,b=i.property,e("starup",(n=f("starup"),l=b(a),c=b(s),n((h=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"starlvLabel",u,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"starlvname",p,babelHelpers.assertThisInitialized(i)),i.gameControl=null,i.mainControl=null,i.type=null,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.initUI()}},{key:"initUI",value:function(){var e=r.getStorage(r.starlv);this.starlvLabel.string=e,cc.res.setSpriteFrame("images/starup/ImgLv"+e+"/spriteFrame",this.starlvname)}},{key:"updateUI",value:function(){}},{key:"show",value:function(e){this.type=e,this.gameControl=cc.find("gameNode").getComponent("gameControl"),this.mainControl=cc.find("gameNode").getComponent("mainControl"),cc.sdk.showBanner()}},{key:"hide",value:function(){this.node.parent.destroy(),cc.sdk.hideBanner()}},{key:"click",value:function(e,t){"close"==t?this.hide():"home"==t&&this.hide(),cc.audio.playSound("audio/button")}}]),t}(o),u=babelHelpers.applyDecoratedDescriptor(h.prototype,"starlvLabel",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=babelHelpers.applyDecoratedDescriptor(h.prototype,"starlvname",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=h))||d)),cc._RF.pop()}}}))}}}));
